/*! For license information please see xeokit-convert.cjs.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.convert2xkt=t():e.convert2xkt=t()}(global,(()=>(()=>{"use strict";var e={231:e=>{e.exports=require("fs")}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};return(()=>{r.r(n),r.d(n,{XKTModel:()=>Le,XKT_INFO:()=>f,buildBoxGeometry:()=>wr,buildBoxLinesGeometry:()=>br,buildCylinderGeometry:()=>Mr,buildGridGeometry:()=>Ir,buildPlaneGeometry:()=>Tr,buildSphereGeometry:()=>Ar,buildTorusGeometry:()=>Sr,buildVectorTextGeometry:()=>Lr,convert2xkt:()=>Dr,parseCityJSONIntoXKTModel:()=>dt,parseGLTFIntoXKTModel:()=>Tt,parseGLTFJSONIntoXKTModel:()=>kt,parseIFCIntoXKTModel:()=>Rt,parseLASIntoXKTModel:()=>Yt,parseMetaModelIntoXKTModel:()=>Ht,parsePCDIntoXKTModel:()=>$t,parsePLYIntoXKTModel:()=>ir,parseSTLIntoXKTModel:()=>hr,writeXKTModelToArrayBuffer:()=>je});const e=require("@loaders.gl/polyfills");var t,o,i,a,s,u,c,l,h,f={xktVersion:10},d=Float64Array,p=new d(16),m=new d(16),y=new d(4),g={MIN_DOUBLE:-Number.MAX_SAFE_INTEGER,MAX_DOUBLE:Number.MAX_SAFE_INTEGER,DEGTORAD:.0174532925,RADTODEG:57.295779513,vec2:function(e){return new d(e||2)},vec3:function(e){return new d(e||3)},vec4:function(e){return new d(e||4)},mat3:function(e){return new d(e||9)},mat3ToMat4:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new d(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=0,t[4]=e[3],t[5]=e[4],t[6]=e[5],t[7]=0,t[8]=e[6],t[9]=e[7],t[10]=e[8],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4:function(e){return new d(e||16)},mat4ToMat3:function(e,t){},createUUID:function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0,o=4294967295*Math.random()|0;return"".concat(e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255],"-").concat(e[255&r]).concat(e[r>>8&255],"-").concat(e[r>>16&15|64]).concat(e[r>>24&255],"-").concat(e[63&n|128]).concat(e[n>>8&255],"-").concat(e[n>>16&255]).concat(e[n>>24&255]).concat(e[255&o]).concat(e[o>>8&255]).concat(e[o>>16&255]).concat(e[o>>24&255])}}(),clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},fmod:function(e,t){if(e<t)return console.error("math.fmod : Attempting to find modulus within negative range - would be infinite loop - ignoring"),e;for(;t<=e;)e-=t;return e},negateVec4:function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},addVec4:function(e,t,r){return r||(r=e),r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r},addVec4Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t,r[3]=e[3]+t,r},addVec3:function(e,t,r){return r||(r=e),r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r},addVec3Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t,r},subVec4:function(e,t,r){return r||(r=e),r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r[3]=e[3]-t[3],r},subVec3:function(e,t,r){return r||(r=e),r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r},subVec2:function(e,t,r){return r||(r=e),r[0]=e[0]-t[0],r[1]=e[1]-t[1],r},subVec4Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]-t,r[1]=e[1]-t,r[2]=e[2]-t,r[3]=e[3]-t,r},subScalarVec4:function(e,t,r){return r||(r=e),r[0]=t-e[0],r[1]=t-e[1],r[2]=t-e[2],r[3]=t-e[3],r},mulVec4:function(e,t,r){return r||(r=e),r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r[3]=e[3]*t[3],r},mulVec4Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r},mulVec3Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r},mulVec2Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]*t,r[1]=e[1]*t,r},divVec3:function(e,t,r){return r||(r=e),r[0]=e[0]/t[0],r[1]=e[1]/t[1],r[2]=e[2]/t[2],r},divVec4:function(e,t,r){return r||(r=e),r[0]=e[0]/t[0],r[1]=e[1]/t[1],r[2]=e[2]/t[2],r[3]=e[3]/t[3],r},divScalarVec3:function(e,t,r){return r||(r=t),r[0]=e/t[0],r[1]=e/t[1],r[2]=e/t[2],r},divVec3Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]/t,r[1]=e[1]/t,r[2]=e[2]/t,r},divVec4Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]/t,r[1]=e[1]/t,r[2]=e[2]/t,r[3]=e[3]/t,r},divScalarVec4:function(e,t,r){return r||(r=t),r[0]=e/t[0],r[1]=e/t[1],r[2]=e/t[2],r[3]=e/t[3],r},dotVec4:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},cross3Vec4:function(e,t){var r=e[0],n=e[1],o=e[2],i=t[0],a=t[1],s=t[2];return[n*s-o*a,o*i-r*s,r*a-n*i,0]},cross3Vec3:function(e,t,r){r||(r=e);var n=e[0],o=e[1],i=e[2],a=t[0],s=t[1],u=t[2];return r[0]=o*u-i*s,r[1]=i*a-n*u,r[2]=n*s-o*a,r},sqLenVec4:function(e){return g.dotVec4(e,e)},lenVec4:function(e){return Math.sqrt(g.sqLenVec4(e))},dotVec3:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},dotVec2:function(e,t){return e[0]*t[0]+e[1]*t[1]},sqLenVec3:function(e){return g.dotVec3(e,e)},sqLenVec2:function(e){return g.dotVec2(e,e)},lenVec3:function(e){return Math.sqrt(g.sqLenVec3(e))},distVec3:(c=new d(3),function(e,t){return g.lenVec3(g.subVec3(e,t,c))}),lenVec2:function(e){return Math.sqrt(g.sqLenVec2(e))},distVec2:function(){var e=new d(2);return function(t,r){return g.lenVec2(g.subVec2(t,r,e))}}(),rcpVec3:function(e,t){return g.divScalarVec3(1,e,t)},normalizeVec4:function(e,t){var r=1/g.lenVec4(e);return g.mulVec4Scalar(e,r,t)},normalizeVec3:function(e,t){var r=1/g.lenVec3(e);return g.mulVec3Scalar(e,r,t)},normalizeVec2:function(e,t){var r=1/g.lenVec2(e);return g.mulVec2Scalar(e,r,t)},angleVec3:function(e,t){var r=g.dotVec3(e,t)/Math.sqrt(g.sqLenVec3(e)*g.sqLenVec3(t));return r=r<-1?-1:r>1?1:r,Math.acos(r)},vec3FromMat4Scale:(u=new d(3),function(e,t){return u[0]=e[0],u[1]=e[1],u[2]=e[2],t[0]=g.lenVec3(u),u[0]=e[4],u[1]=e[5],u[2]=e[6],t[1]=g.lenVec3(u),u[0]=e[8],u[1]=e[9],u[2]=e[10],t[2]=g.lenVec3(u),t}),vecToArray:function(){function e(e){return Math.round(1e5*e)/1e5}return function(t){for(var r=0,n=(t=Array.prototype.slice.call(t)).length;r<n;r++)t[r]=e(t[r]);return t}}(),xyzArrayToObject:function(e){return{x:e[0],y:e[1],z:e[2]}},xyzObjectToArray:function(e,t){return(t=t||new d(3))[0]=e.x,t[1]=e.y,t[2]=e.z,t},dupMat4:function(e){return e.slice(0,16)},mat4To3:function(e){return[e[0],e[1],e[2],e[4],e[5],e[6],e[8],e[9],e[10]]},m4s:function(e){return[e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e]},setMat4ToZeroes:function(){return g.m4s(0)},setMat4ToOnes:function(){return g.m4s(1)},diagonalMat4v:function(e){return new d([e[0],0,0,0,0,e[1],0,0,0,0,e[2],0,0,0,0,e[3]])},diagonalMat4c:function(e,t,r,n){return g.diagonalMat4v([e,t,r,n])},diagonalMat4s:function(e){return g.diagonalMat4c(e,e,e,e)},identityMat4:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new d(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},identityMat3:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new d(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},isIdentityMat4:function(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]},negateMat4:function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t[9]=-e[9],t[10]=-e[10],t[11]=-e[11],t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=-e[15],t},addMat4:function(e,t,r){return r||(r=e),r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r[4]=e[4]+t[4],r[5]=e[5]+t[5],r[6]=e[6]+t[6],r[7]=e[7]+t[7],r[8]=e[8]+t[8],r[9]=e[9]+t[9],r[10]=e[10]+t[10],r[11]=e[11]+t[11],r[12]=e[12]+t[12],r[13]=e[13]+t[13],r[14]=e[14]+t[14],r[15]=e[15]+t[15],r},addMat4Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t,r[3]=e[3]+t,r[4]=e[4]+t,r[5]=e[5]+t,r[6]=e[6]+t,r[7]=e[7]+t,r[8]=e[8]+t,r[9]=e[9]+t,r[10]=e[10]+t,r[11]=e[11]+t,r[12]=e[12]+t,r[13]=e[13]+t,r[14]=e[14]+t,r[15]=e[15]+t,r},addScalarMat4:function(e,t,r){return g.addMat4Scalar(t,e,r)},subMat4:function(e,t,r){return r||(r=e),r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r[3]=e[3]-t[3],r[4]=e[4]-t[4],r[5]=e[5]-t[5],r[6]=e[6]-t[6],r[7]=e[7]-t[7],r[8]=e[8]-t[8],r[9]=e[9]-t[9],r[10]=e[10]-t[10],r[11]=e[11]-t[11],r[12]=e[12]-t[12],r[13]=e[13]-t[13],r[14]=e[14]-t[14],r[15]=e[15]-t[15],r},subMat4Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]-t,r[1]=e[1]-t,r[2]=e[2]-t,r[3]=e[3]-t,r[4]=e[4]-t,r[5]=e[5]-t,r[6]=e[6]-t,r[7]=e[7]-t,r[8]=e[8]-t,r[9]=e[9]-t,r[10]=e[10]-t,r[11]=e[11]-t,r[12]=e[12]-t,r[13]=e[13]-t,r[14]=e[14]-t,r[15]=e[15]-t,r},subScalarMat4:function(e,t,r){return r||(r=t),r[0]=e-t[0],r[1]=e-t[1],r[2]=e-t[2],r[3]=e-t[3],r[4]=e-t[4],r[5]=e-t[5],r[6]=e-t[6],r[7]=e-t[7],r[8]=e-t[8],r[9]=e-t[9],r[10]=e-t[10],r[11]=e-t[11],r[12]=e-t[12],r[13]=e-t[13],r[14]=e-t[14],r[15]=e-t[15],r},mulMat4:function(e,t,r){r||(r=e);var n=e[0],o=e[1],i=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],h=e[8],f=e[9],d=e[10],p=e[11],v=e[12],m=e[13],y=e[14],g=e[15],x=t[0],w=t[1],b=t[2],M=t[3],I=t[4],T=t[5],A=t[6],S=t[7],O=t[8],L=t[9],P=t[10],E=t[11],j=t[12],G=t[13],_=t[14],D=t[15];return r[0]=x*n+w*s+b*h+M*v,r[1]=x*o+w*u+b*f+M*m,r[2]=x*i+w*c+b*d+M*y,r[3]=x*a+w*l+b*p+M*g,r[4]=I*n+T*s+A*h+S*v,r[5]=I*o+T*u+A*f+S*m,r[6]=I*i+T*c+A*d+S*y,r[7]=I*a+T*l+A*p+S*g,r[8]=O*n+L*s+P*h+E*v,r[9]=O*o+L*u+P*f+E*m,r[10]=O*i+L*c+P*d+E*y,r[11]=O*a+L*l+P*p+E*g,r[12]=j*n+G*s+_*h+D*v,r[13]=j*o+G*u+_*f+D*m,r[14]=j*i+G*c+_*d+D*y,r[15]=j*a+G*l+_*p+D*g,r},mulMat3:function(e,t,r){r||(r=new d(9));var n=e[0],o=e[3],i=e[6],a=e[1],s=e[4],u=e[7],c=e[2],l=e[5],h=e[8],f=t[0],p=t[3],v=t[6],m=t[1],y=t[4],g=t[7],x=t[2],w=t[5],b=t[8];return r[0]=n*f+o*m+i*x,r[3]=n*p+o*y+i*w,r[6]=n*v+o*g+i*b,r[1]=a*f+s*m+u*x,r[4]=a*p+s*y+u*w,r[7]=a*v+s*g+u*b,r[2]=c*f+l*m+h*x,r[5]=c*p+l*y+h*w,r[8]=c*v+l*g+h*b,r},mulMat4Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r[4]=e[4]*t,r[5]=e[5]*t,r[6]=e[6]*t,r[7]=e[7]*t,r[8]=e[8]*t,r[9]=e[9]*t,r[10]=e[10]*t,r[11]=e[11]*t,r[12]=e[12]*t,r[13]=e[13]*t,r[14]=e[14]*t,r[15]=e[15]*t,r},mulMat4v4:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.vec4(),n=t[0],o=t[1],i=t[2],a=t[3];return r[0]=e[0]*n+e[4]*o+e[8]*i+e[12]*a,r[1]=e[1]*n+e[5]*o+e[9]*i+e[13]*a,r[2]=e[2]*n+e[6]*o+e[10]*i+e[14]*a,r[3]=e[3]*n+e[7]*o+e[11]*i+e[15]*a,r},transposeMat4:function(e,t){var r=e[4],n=e[14],o=e[8],i=e[13],a=e[12],s=e[9];if(!t||e===t){var u=e[1],c=e[2],l=e[3],h=e[6],f=e[7],d=e[11];return e[1]=r,e[2]=o,e[3]=a,e[4]=u,e[6]=s,e[7]=i,e[8]=c,e[9]=h,e[11]=n,e[12]=l,e[13]=f,e[14]=d,e}return t[0]=e[0],t[1]=r,t[2]=o,t[3]=a,t[4]=e[1],t[5]=e[5],t[6]=s,t[7]=i,t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=n,t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},transposeMat3:function(e,t){if(t===e){var r=e[1],n=e[2],o=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=o}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},determinantMat4:function(e){var t=e[0],r=e[1],n=e[2],o=e[3],i=e[4],a=e[5],s=e[6],u=e[7],c=e[8],l=e[9],h=e[10],f=e[11],d=e[12],p=e[13],v=e[14],m=e[15];return d*l*s*o-c*p*s*o-d*a*h*o+i*p*h*o+c*a*v*o-i*l*v*o-d*l*n*u+c*p*n*u+d*r*h*u-t*p*h*u-c*r*v*u+t*l*v*u+d*a*n*f-i*p*n*f-d*r*s*f+t*p*s*f+i*r*v*f-t*a*v*f-c*a*n*m+i*l*n*m+c*r*s*m-t*l*s*m-i*r*h*m+t*a*h*m},inverseMat4:function(e,t){t||(t=e);var r=e[0],n=e[1],o=e[2],i=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],h=e[9],f=e[10],d=e[11],p=e[12],v=e[13],m=e[14],y=e[15],g=r*s-n*a,x=r*u-o*a,w=r*c-i*a,b=n*u-o*s,M=n*c-i*s,I=o*c-i*u,T=l*v-h*p,A=l*m-f*p,S=l*y-d*p,O=h*m-f*v,L=h*y-d*v,P=f*y-d*m,E=1/(g*P-x*L+w*O+b*S-M*A+I*T);return t[0]=(s*P-u*L+c*O)*E,t[1]=(-n*P+o*L-i*O)*E,t[2]=(v*I-m*M+y*b)*E,t[3]=(-h*I+f*M-d*b)*E,t[4]=(-a*P+u*S-c*A)*E,t[5]=(r*P-o*S+i*A)*E,t[6]=(-p*I+m*w-y*x)*E,t[7]=(l*I-f*w+d*x)*E,t[8]=(a*L-s*S+c*T)*E,t[9]=(-r*L+n*S-i*T)*E,t[10]=(p*M-v*w+y*g)*E,t[11]=(-l*M+h*w-d*g)*E,t[12]=(-a*O+s*A-u*T)*E,t[13]=(r*O-n*A+o*T)*E,t[14]=(-p*b+v*x-m*g)*E,t[15]=(l*b-h*x+f*g)*E,t},traceMat4:function(e){return e[0]+e[5]+e[10]+e[15]},translationMat4v:function(e,t){var r=t||g.identityMat4();return r[12]=e[0],r[13]=e[1],r[14]=e[2],r},translationMat3v:function(e,t){var r=t||g.identityMat3();return r[6]=e[0],r[7]=e[1],r},translationMat4c:(s=new d(3),function(e,t,r,n){return s[0]=e,s[1]=t,s[2]=r,g.translationMat4v(s,n)}),translationMat4s:function(e,t){return g.translationMat4c(e,e,e,t)},translateMat4v:function(e,t){return g.translateMat4c(e[0],e[1],e[2],t)},OLDtranslateMat4c:function(e,t,r,n){var o=n[12];n[0]+=o*e,n[4]+=o*t,n[8]+=o*r;var i=n[13];n[1]+=i*e,n[5]+=i*t,n[9]+=i*r;var a=n[14];n[2]+=a*e,n[6]+=a*t,n[10]+=a*r;var s=n[15];return n[3]+=s*e,n[7]+=s*t,n[11]+=s*r,n},translateMat4c:function(e,t,r,n){var o=n[3];n[0]+=o*e,n[1]+=o*t,n[2]+=o*r;var i=n[7];n[4]+=i*e,n[5]+=i*t,n[6]+=i*r;var a=n[11];n[8]+=a*e,n[9]+=a*t,n[10]+=a*r;var s=n[15];return n[12]+=s*e,n[13]+=s*t,n[14]+=s*r,n},rotationMat4v:function(e,t,r){var n,o,i,a,s,u,c=g.normalizeVec4([t[0],t[1],t[2],0],[]),l=Math.sin(e),h=Math.cos(e),f=1-h,d=c[0],p=c[1],v=c[2];return n=d*p,o=p*v,i=v*d,a=d*l,s=p*l,u=v*l,(r=r||g.mat4())[0]=f*d*d+h,r[1]=f*n+u,r[2]=f*i-s,r[3]=0,r[4]=f*n-u,r[5]=f*p*p+h,r[6]=f*o+a,r[7]=0,r[8]=f*i+s,r[9]=f*o-a,r[10]=f*v*v+h,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},rotationMat4c:function(e,t,r,n,o){return g.rotationMat4v(e,[t,r,n],o)},scalingMat4v:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.identityMat4();return t[0]=e[0],t[5]=e[1],t[10]=e[2],t},scalingMat3v:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.identityMat3();return t[0]=e[0],t[4]=e[1],t},scalingMat4c:function(){var e=new d(3);return function(t,r,n,o){return e[0]=t,e[1]=r,e[2]=n,g.scalingMat4v(e,o)}}(),scaleMat4c:function(e,t,r,n){return n[0]*=e,n[4]*=t,n[8]*=r,n[1]*=e,n[5]*=t,n[9]*=r,n[2]*=e,n[6]*=t,n[10]*=r,n[3]*=e,n[7]*=t,n[11]*=r,n},scaleMat4v:function(e,t){var r=e[0],n=e[1],o=e[2];return t[0]*=r,t[4]*=n,t[8]*=o,t[1]*=r,t[5]*=n,t[9]*=o,t[2]*=r,t[6]*=n,t[10]*=o,t[3]*=r,t[7]*=n,t[11]*=o,t},scalingMat4s:function(e){return g.scalingMat4c(e,e,e)},rotationTranslationMat4:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.mat4(),n=e[0],o=e[1],i=e[2],a=e[3],s=n+n,u=o+o,c=i+i,l=n*s,h=n*u,f=n*c,d=o*u,p=o*c,v=i*c,m=a*s,y=a*u,x=a*c;return r[0]=1-(d+v),r[1]=h+x,r[2]=f-y,r[3]=0,r[4]=h-x,r[5]=1-(l+v),r[6]=p+m,r[7]=0,r[8]=f+y,r[9]=p-m,r[10]=1-(l+d),r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r},mat4ToEuler:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.vec4(),n=g.clamp,o=e[0],i=e[4],a=e[8],s=e[1],u=e[5],c=e[9],l=e[2],h=e[6],f=e[10];return"XYZ"===t?(r[1]=Math.asin(n(a,-1,1)),Math.abs(a)<.99999?(r[0]=Math.atan2(-c,f),r[2]=Math.atan2(-i,o)):(r[0]=Math.atan2(h,u),r[2]=0)):"YXZ"===t?(r[0]=Math.asin(-n(c,-1,1)),Math.abs(c)<.99999?(r[1]=Math.atan2(a,f),r[2]=Math.atan2(s,u)):(r[1]=Math.atan2(-l,o),r[2]=0)):"ZXY"===t?(r[0]=Math.asin(n(h,-1,1)),Math.abs(h)<.99999?(r[1]=Math.atan2(-l,f),r[2]=Math.atan2(-i,u)):(r[1]=0,r[2]=Math.atan2(s,o))):"ZYX"===t?(r[1]=Math.asin(-n(l,-1,1)),Math.abs(l)<.99999?(r[0]=Math.atan2(h,f),r[2]=Math.atan2(s,o)):(r[0]=0,r[2]=Math.atan2(-i,u))):"YZX"===t?(r[2]=Math.asin(n(s,-1,1)),Math.abs(s)<.99999?(r[0]=Math.atan2(-c,u),r[1]=Math.atan2(-l,o)):(r[0]=0,r[1]=Math.atan2(a,f))):"XZY"===t&&(r[2]=Math.asin(-n(i,-1,1)),Math.abs(i)<.99999?(r[0]=Math.atan2(h,u),r[1]=Math.atan2(a,o)):(r[0]=Math.atan2(-c,f),r[1]=0)),r},composeMat4:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g.mat4();return g.quaternionToRotationMat4(t,n),g.scaleMat4v(r,n),g.translateMat4v(e,n),n},decomposeMat4:function(){var e=new d(3),t=new d(16);return function(r,n,o,i){e[0]=r[0],e[1]=r[1],e[2]=r[2];var a=g.lenVec3(e);e[0]=r[4],e[1]=r[5],e[2]=r[6];var s=g.lenVec3(e);e[8]=r[8],e[9]=r[9],e[10]=r[10];var u=g.lenVec3(e);g.determinantMat4(r)<0&&(a=-a),n[0]=r[12],n[1]=r[13],n[2]=r[14],t.set(r);var c=1/a,l=1/s,h=1/u;return t[0]*=c,t[1]*=c,t[2]*=c,t[4]*=l,t[5]*=l,t[6]*=l,t[8]*=h,t[9]*=h,t[10]*=h,g.mat4ToQuaternion(t,o),i[0]=a,i[1]=s,i[2]=u,this}}(),lookAtMat4v:function(e,t,r,n){n||(n=g.mat4());var o,i,a,s,u,c,l,h,f,d,p=e[0],v=e[1],m=e[2],y=r[0],x=r[1],w=r[2],b=t[0],M=t[1],I=t[2];return p===b&&v===M&&m===I?g.identityMat4():(o=p-b,i=v-M,a=m-I,s=x*(a*=d=1/Math.sqrt(o*o+i*i+a*a))-w*(i*=d),u=w*(o*=d)-y*a,c=y*i-x*o,(d=Math.sqrt(s*s+u*u+c*c))?(s*=d=1/d,u*=d,c*=d):(s=0,u=0,c=0),l=i*c-a*u,h=a*s-o*c,f=o*u-i*s,(d=Math.sqrt(l*l+h*h+f*f))?(l*=d=1/d,h*=d,f*=d):(l=0,h=0,f=0),n[0]=s,n[1]=l,n[2]=o,n[3]=0,n[4]=u,n[5]=h,n[6]=i,n[7]=0,n[8]=c,n[9]=f,n[10]=a,n[11]=0,n[12]=-(s*p+u*v+c*m),n[13]=-(l*p+h*v+f*m),n[14]=-(o*p+i*v+a*m),n[15]=1,n)},lookAtMat4c:function(e,t,r,n,o,i,a,s,u){return g.lookAtMat4v([e,t,r],[n,o,i],[a,s,u],[])},orthoMat4c:function(e,t,r,n,o,i,a){a||(a=g.mat4());var s=t-e,u=n-r,c=i-o;return a[0]=2/s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2/u,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=-2/c,a[11]=0,a[12]=-(e+t)/s,a[13]=-(n+r)/u,a[14]=-(i+o)/c,a[15]=1,a},frustumMat4v:function(e,t,r){r||(r=g.mat4());var n=[e[0],e[1],e[2],0],o=[t[0],t[1],t[2],0];g.addVec4(o,n,p),g.subVec4(o,n,m);var i=2*n[2],a=m[0],s=m[1],u=m[2];return r[0]=i/a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=i/s,r[6]=0,r[7]=0,r[8]=p[0]/a,r[9]=p[1]/s,r[10]=-p[2]/u,r[11]=-1,r[12]=0,r[13]=0,r[14]=-i*o[2]/u,r[15]=0,r},frustumMat4:function(e,t,r,n,o,i,a){a||(a=g.mat4());var s=t-e,u=n-r,c=i-o;return a[0]=2*o/s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*o/u,a[6]=0,a[7]=0,a[8]=(t+e)/s,a[9]=(n+r)/u,a[10]=-(i+o)/c,a[11]=-1,a[12]=0,a[13]=0,a[14]=-i*o*2/c,a[15]=0,a},perspectiveMat4:function(e,t,r,n,o){var i=[],a=[];return i[2]=r,a[2]=n,a[1]=i[2]*Math.tan(e/2),i[1]=-a[1],a[0]=a[1]*t,i[0]=-a[0],g.frustumMat4v(i,a,o)},transformPoint3:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.vec3(),n=t[0],o=t[1],i=t[2];return r[0]=e[0]*n+e[4]*o+e[8]*i+e[12],r[1]=e[1]*n+e[5]*o+e[9]*i+e[13],r[2]=e[2]*n+e[6]*o+e[10]*i+e[14],r},transformPoint4:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.vec4();return r[0]=e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12]*t[3],r[1]=e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13]*t[3],r[2]=e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14]*t[3],r[3]=e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15]*t[3],r},transformPoints3:function(e,t,r){for(var n,o,i,a,s,u=r||[],c=t.length,l=e[0],h=e[1],f=e[2],d=e[3],p=e[4],v=e[5],m=e[6],y=e[7],g=e[8],x=e[9],w=e[10],b=e[11],M=e[12],I=e[13],T=e[14],A=e[15],S=0;S<c;++S)n=(a=t[S])[0],o=a[1],i=a[2],(s=u[S]||(u[S]=[0,0,0]))[0]=l*n+p*o+g*i+M,s[1]=h*n+v*o+x*i+I,s[2]=f*n+m*o+w*i+T,s[3]=d*n+y*o+b*i+A;return u.length=c,u},transformPositions3:function(e,t){var r,n,o,i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,s=t.length,u=e[0],c=e[1],l=e[2],h=e[3],f=e[4],d=e[5],p=e[6],v=e[7],m=e[8],y=e[9],g=e[10],x=e[11],w=e[12],b=e[13],M=e[14],I=e[15];for(r=0;r<s;r+=3)n=t[r+0],o=t[r+1],i=t[r+2],a[r+0]=u*n+f*o+m*i+w,a[r+1]=c*n+d*o+y*i+b,a[r+2]=l*n+p*o+g*i+M,a[r+3]=h*n+v*o+x*i+I;return a},transformPositions4:function(e,t){var r,n,o,i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,s=t.length,u=e[0],c=e[1],l=e[2],h=e[3],f=e[4],d=e[5],p=e[6],v=e[7],m=e[8],y=e[9],g=e[10],x=e[11],w=e[12],b=e[13],M=e[14],I=e[15];for(r=0;r<s;r+=4)n=t[r+0],o=t[r+1],i=t[r+2],a[r+0]=u*n+f*o+m*i+w,a[r+1]=c*n+d*o+y*i+b,a[r+2]=l*n+p*o+g*i+M,a[r+3]=h*n+v*o+x*i+I;return a},transformVec3:function(e,t,r){var n=t[0],o=t[1],i=t[2];return(r=r||this.vec3())[0]=e[0]*n+e[4]*o+e[8]*i,r[1]=e[1]*n+e[5]*o+e[9]*i,r[2]=e[2]*n+e[6]*o+e[10]*i,r},transformVec4:function(e,t,r){var n=t[0],o=t[1],i=t[2],a=t[3];return(r=r||g.vec4())[0]=e[0]*n+e[4]*o+e[8]*i+e[12]*a,r[1]=e[1]*n+e[5]*o+e[9]*i+e[13]*a,r[2]=e[2]*n+e[6]*o+e[10]*i+e[14]*a,r[3]=e[3]*n+e[7]*o+e[11]*i+e[15]*a,r},rotateVec3X:function(e,t,r,n){var o=[],i=[];return o[0]=e[0]-t[0],o[1]=e[1]-t[1],o[2]=e[2]-t[2],i[0]=o[0],i[1]=o[1]*Math.cos(r)-o[2]*Math.sin(r),i[2]=o[1]*Math.sin(r)+o[2]*Math.cos(r),n[0]=i[0]+t[0],n[1]=i[1]+t[1],n[2]=i[2]+t[2],n},rotateVec3Y:function(e,t,r,n){var o=[],i=[];return o[0]=e[0]-t[0],o[1]=e[1]-t[1],o[2]=e[2]-t[2],i[0]=o[2]*Math.sin(r)+o[0]*Math.cos(r),i[1]=o[1],i[2]=o[2]*Math.cos(r)-o[0]*Math.sin(r),n[0]=i[0]+t[0],n[1]=i[1]+t[1],n[2]=i[2]+t[2],n},rotateVec3Z:function(e,t,r,n){var o=[],i=[];return o[0]=e[0]-t[0],o[1]=e[1]-t[1],o[2]=e[2]-t[2],i[0]=o[0]*Math.cos(r)-o[1]*Math.sin(r),i[1]=o[0]*Math.sin(r)+o[1]*Math.cos(r),i[2]=o[2],n[0]=i[0]+t[0],n[1]=i[1]+t[1],n[2]=i[2]+t[2],n},projectVec4:function(e,t){var r=1/e[3];return(t=t||g.vec2())[0]=v[0]*r,t[1]=v[1]*r,t},unprojectVec3:(o=new d(16),i=new d(16),a=new d(16),function(e,t,r,n){return this.transformVec3(this.mulMat4(this.inverseMat4(t,o),this.inverseMat4(r,i),a),e,n)}),lerpVec3:function(e,t,r,n,o,i){var a=i||g.vec3(),s=(e-t)/(r-t);return a[0]=n[0]+s*(o[0]-n[0]),a[1]=n[1]+s*(o[1]-n[1]),a[2]=n[2]+s*(o[2]-n[2]),a},flatten:function(e){var t,r,n,o,i,a=[];for(t=0,r=e.length;t<r;t++)for(n=0,o=(i=e[t]).length;n<o;n++)a.push(i[n]);return a},identityQuaternion:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.vec4();return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},eulerToQuaternion:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.vec4(),n=e[0]*g.DEGTORAD/2,o=e[1]*g.DEGTORAD/2,i=e[2]*g.DEGTORAD/2,a=Math.cos(n),s=Math.cos(o),u=Math.cos(i),c=Math.sin(n),l=Math.sin(o),h=Math.sin(i);return"XYZ"===t?(r[0]=c*s*u+a*l*h,r[1]=a*l*u-c*s*h,r[2]=a*s*h+c*l*u,r[3]=a*s*u-c*l*h):"YXZ"===t?(r[0]=c*s*u+a*l*h,r[1]=a*l*u-c*s*h,r[2]=a*s*h-c*l*u,r[3]=a*s*u+c*l*h):"ZXY"===t?(r[0]=c*s*u-a*l*h,r[1]=a*l*u+c*s*h,r[2]=a*s*h+c*l*u,r[3]=a*s*u-c*l*h):"ZYX"===t?(r[0]=c*s*u-a*l*h,r[1]=a*l*u+c*s*h,r[2]=a*s*h-c*l*u,r[3]=a*s*u+c*l*h):"YZX"===t?(r[0]=c*s*u+a*l*h,r[1]=a*l*u+c*s*h,r[2]=a*s*h-c*l*u,r[3]=a*s*u-c*l*h):"XZY"===t&&(r[0]=c*s*u-a*l*h,r[1]=a*l*u-c*s*h,r[2]=a*s*h+c*l*u,r[3]=a*s*u+c*l*h),r},mat4ToQuaternion:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.vec4(),n=e[0],o=e[4],i=e[8],a=e[1],s=e[5],u=e[9],c=e[2],l=e[6],h=e[10],f=n+s+h;return f>0?(t=.5/Math.sqrt(f+1),r[3]=.25/t,r[0]=(l-u)*t,r[1]=(i-c)*t,r[2]=(a-o)*t):n>s&&n>h?(t=2*Math.sqrt(1+n-s-h),r[3]=(l-u)/t,r[0]=.25*t,r[1]=(o+a)/t,r[2]=(i+c)/t):s>h?(t=2*Math.sqrt(1+s-n-h),r[3]=(i-c)/t,r[0]=(o+a)/t,r[1]=.25*t,r[2]=(u+l)/t):(t=2*Math.sqrt(1+h-n-s),r[3]=(a-o)/t,r[0]=(i+c)/t,r[1]=(u+l)/t,r[2]=.25*t),r},vec3PairToQuaternion:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.vec4(),n=Math.sqrt(g.dotVec3(e,e)*g.dotVec3(t,t)),o=n+g.dotVec3(e,t);return o<1e-8*n?(o=0,Math.abs(e[0])>Math.abs(e[2])?(r[0]=-e[1],r[1]=e[0],r[2]=0):(r[0]=0,r[1]=-e[2],r[2]=e[1])):g.cross3Vec3(e,t,r),r[3]=o,g.normalizeQuaternion(r)},angleAxisToQuaternion:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.vec4(),r=e[3]/2,n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t},quaternionToEuler:function(){var e=new d(16);return function(t,r,n){return n=n||g.vec3(),g.quaternionToRotationMat4(t,e),g.mat4ToEuler(e,r,n),n}}(),mulQuaternions:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.vec4(),n=e[0],o=e[1],i=e[2],a=e[3],s=t[0],u=t[1],c=t[2],l=t[3];return r[0]=a*s+n*l+o*c-i*u,r[1]=a*u+o*l+i*s-n*c,r[2]=a*c+i*l+n*u-o*s,r[3]=a*l-n*s-o*u-i*c,r},vec3ApplyQuaternion:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.vec3(),n=t[0],o=t[1],i=t[2],a=e[0],s=e[1],u=e[2],c=e[3],l=c*n+s*i-u*o,h=c*o+u*n-a*i,f=c*i+a*o-s*n,d=-a*n-s*o-u*i;return r[0]=l*c+d*-a+h*-u-f*-s,r[1]=h*c+d*-s+f*-a-l*-u,r[2]=f*c+d*-u+l*-s-h*-a,r},quaternionToMat4:function(e,t){t=g.identityMat4(t);var r=e[0],n=e[1],o=e[2],i=e[3],a=2*r,s=2*n,u=2*o,c=a*i,l=s*i,h=u*i,f=a*r,d=s*r,p=u*r,v=s*n,m=u*n,y=u*o;return t[0]=1-(v+y),t[1]=d+h,t[2]=p-l,t[4]=d-h,t[5]=1-(f+y),t[6]=m+c,t[8]=p+l,t[9]=m-c,t[10]=1-(f+v),t},quaternionToRotationMat4:function(e,t){var r=e[0],n=e[1],o=e[2],i=e[3],a=r+r,s=n+n,u=o+o,c=r*a,l=r*s,h=r*u,f=n*s,d=n*u,p=o*u,v=i*a,m=i*s,y=i*u;return t[0]=1-(f+p),t[4]=l-y,t[8]=h+m,t[1]=l+y,t[5]=1-(c+p),t[9]=d-v,t[2]=h-m,t[6]=d+v,t[10]=1-(c+f),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},normalizeQuaternion:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,r=g.lenVec4([e[0],e[1],e[2],e[3]]);return t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r,t[3]=e[3]/r,t},conjugateQuaternion:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},inverseQuaternion:function(e,t){return g.normalizeQuaternion(g.conjugateQuaternion(e,t))},quaternionToAngleAxis:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.vec4(),r=(e=g.normalizeQuaternion(e,y))[3],n=2*Math.acos(r),o=Math.sqrt(1-r*r);return o<.001?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=e[0]/o,t[1]=e[1]/o,t[2]=e[2]/o),t[3]=n,t},AABB3:function(e){return new d(e||6)},AABB2:function(e){return new d(e||4)},OBB3:function(e){return new d(e||32)},OBB2:function(e){return new d(e||16)},Sphere3:function(e,t,r,n){return new d([e,t,r,n])},transformOBB3:function(e,t){var r,n,o,i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,s=t.length,u=e[0],c=e[1],l=e[2],h=e[3],f=e[4],d=e[5],p=e[6],v=e[7],m=e[8],y=e[9],g=e[10],x=e[11],w=e[12],b=e[13],M=e[14],I=e[15];for(r=0;r<s;r+=4)n=t[r+0],o=t[r+1],i=t[r+2],a[r+0]=u*n+f*o+m*i+w,a[r+1]=c*n+d*o+y*i+b,a[r+2]=l*n+p*o+g*i+M,a[r+3]=h*n+v*o+x*i+I;return a},containsAABB3:function(e,t){return e[0]<=t[0]&&t[3]<=e[3]&&e[1]<=t[1]&&t[4]<=e[4]&&e[2]<=t[2]&&t[5]<=e[5]},getAABB3Diag:function(){var e=new d(3),t=new d(3),r=new d(3);return function(n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],t[0]=n[3],t[1]=n[4],t[2]=n[5],g.subVec3(t,e,r),Math.abs(g.lenVec3(r))}}(),getAABB3DiagPoint:function(){var e=new d(3),t=new d(3),r=new d(3);return function(n,o){e[0]=n[0],e[1]=n[1],e[2]=n[2],t[0]=n[3],t[1]=n[4],t[2]=n[5];var i=g.subVec3(t,e,r),a=o[0]-n[0],s=n[3]-o[0],u=o[1]-n[1],c=n[4]-o[1],l=o[2]-n[2],h=n[5]-o[2];return i[0]+=a>s?a:s,i[1]+=u>c?u:c,i[2]+=l>h?l:h,Math.abs(g.lenVec3(i))}}(),getAABB3Center:function(e,t){var r=t||g.vec3();return r[0]=(e[0]+e[3])/2,r[1]=(e[1]+e[4])/2,r[2]=(e[2]+e[5])/2,r},getAABB2Center:function(e,t){var r=t||g.vec2();return r[0]=(e[2]+e[0])/2,r[1]=(e[3]+e[1])/2,r},collapseAABB3:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.AABB3();return e[0]=g.MAX_DOUBLE,e[1]=g.MAX_DOUBLE,e[2]=g.MAX_DOUBLE,e[3]=-g.MAX_DOUBLE,e[4]=-g.MAX_DOUBLE,e[5]=-g.MAX_DOUBLE,e},AABB3ToOBB3:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.OBB3();return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=1,t[4]=e[3],t[5]=e[1],t[6]=e[2],t[7]=1,t[8]=e[3],t[9]=e[4],t[10]=e[2],t[11]=1,t[12]=e[0],t[13]=e[4],t[14]=e[2],t[15]=1,t[16]=e[0],t[17]=e[1],t[18]=e[5],t[19]=1,t[20]=e[3],t[21]=e[1],t[22]=e[5],t[23]=1,t[24]=e[3],t[25]=e[4],t[26]=e[5],t[27]=1,t[28]=e[0],t[29]=e[4],t[30]=e[5],t[31]=1,t},positions3ToAABB3:(t=new d(3),function(e,r,n){r=r||g.AABB3();for(var o,i,a,s=g.MAX_DOUBLE,u=g.MAX_DOUBLE,c=g.MAX_DOUBLE,l=-g.MAX_DOUBLE,h=-g.MAX_DOUBLE,f=-g.MAX_DOUBLE,d=0,p=e.length;d<p;d+=3)n?(t[0]=e[d+0],t[1]=e[d+1],t[2]=e[d+2],g.decompressPosition(t,n,t),o=t[0],i=t[1],a=t[2]):(o=e[d+0],i=e[d+1],a=e[d+2]),o<s&&(s=o),i<u&&(u=i),a<c&&(c=a),o>l&&(l=o),i>h&&(h=i),a>f&&(f=a);return r[0]=s,r[1]=u,r[2]=c,r[3]=l,r[4]=h,r[5]=f,r}),OBB3ToAABB3:function(e){for(var t,r,n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.AABB3(),i=g.MAX_DOUBLE,a=g.MAX_DOUBLE,s=g.MAX_DOUBLE,u=-g.MAX_DOUBLE,c=-g.MAX_DOUBLE,l=-g.MAX_DOUBLE,h=0,f=e.length;h<f;h+=4)(t=e[h+0])<i&&(i=t),(r=e[h+1])<a&&(a=r),(n=e[h+2])<s&&(s=n),t>u&&(u=t),r>c&&(c=r),n>l&&(l=n);return o[0]=i,o[1]=a,o[2]=s,o[3]=u,o[4]=c,o[5]=l,o},points3ToAABB3:function(e){for(var t,r,n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.AABB3(),i=g.MAX_DOUBLE,a=g.MAX_DOUBLE,s=g.MAX_DOUBLE,u=-g.MAX_DOUBLE,c=-g.MAX_DOUBLE,l=-g.MAX_DOUBLE,h=0,f=e.length;h<f;h++)(t=e[h][0])<i&&(i=t),(r=e[h][1])<a&&(a=r),(n=e[h][2])<s&&(s=n),t>u&&(u=t),r>c&&(c=r),n>l&&(l=n);return o[0]=i,o[1]=a,o[2]=s,o[3]=u,o[4]=c,o[5]=l,o},points3ToSphere3:function(){var e=new d(3);return function(t,r){r=r||g.vec4();var n,o=0,i=0,a=0,s=t.length;for(n=0;n<s;n++)o+=t[n][0],i+=t[n][1],a+=t[n][2];r[0]=o/s,r[1]=i/s,r[2]=a/s;var u,c=0;for(n=0;n<s;n++)(u=Math.abs(g.lenVec3(g.subVec3(t[n],r,e))))>c&&(c=u);return r[3]=c,r}}(),positions3ToSphere3:function(){var e=new d(3),t=new d(3);return function(r,n){n=n||g.vec4();var o,i=0,a=0,s=0,u=r.length,c=0;for(o=0;o<u;o+=3)i+=r[o],a+=r[o+1],s+=r[o+2];var l,h=u/3;for(n[0]=i/h,n[1]=a/h,n[2]=s/h,o=0;o<u;o+=3)e[0]=r[o],e[1]=r[o+1],e[2]=r[o+2],(l=Math.abs(g.lenVec3(g.subVec3(e,n,t))))>c&&(c=l);return n[3]=c,n}}(),OBB3ToSphere3:function(){var e=new d(3),t=new d(3);return function(r,n){n=n||g.vec4();var o,i=0,a=0,s=0,u=r.length,c=u/4;for(o=0;o<u;o+=4)i+=r[o+0],a+=r[o+1],s+=r[o+2];n[0]=i/c,n[1]=a/c,n[2]=s/c;var l,h=0;for(o=0;o<u;o+=4)e[0]=r[o+0],e[1]=r[o+1],e[2]=r[o+2],(l=Math.abs(g.lenVec3(g.subVec3(e,n,t))))>h&&(h=l);return n[3]=h,n}}(),getSphere3Center:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.vec3();return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},expandAABB3:function(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[3]&&(e[3]=t[3]),e[4]<t[4]&&(e[4]=t[4]),e[5]<t[5]&&(e[5]=t[5]),e},expandAABB3Point3:function(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[0]&&(e[3]=t[0]),e[4]<t[1]&&(e[4]=t[1]),e[5]<t[2]&&(e[5]=t[2]),e},triangleNormal:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g.vec3(),o=t[0]-e[0],i=t[1]-e[1],a=t[2]-e[2],s=r[0]-e[0],u=r[1]-e[1],c=r[2]-e[2],l=i*c-a*u,h=a*s-o*c,f=o*u-i*s,d=Math.sqrt(l*l+h*h+f*f);return 0===d?(n[0]=0,n[1]=0,n[2]=0):(n[0]=l/d,n[1]=h/d,n[2]=f/d),n}};function x(e,t,r,n){var o=e[t]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2])),i=e[t+1]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2]));if(e[t+2]<0){var a=(1-Math.abs(i))*(o>=0?1:-1),s=(1-Math.abs(o))*(i>=0?1:-1);o=a,i=s}return new Int8Array([Math[r](127.5*o+(o<0?-1:0)),Math[n](127.5*i+(i<0?-1:0))])}function w(e){var t=e[0],r=e[1];t/=t<0?127:128,r/=r<0?127:128;var n=1-Math.abs(t)-Math.abs(r);n<0&&(t=(1-Math.abs(r))*(t>=0?1:-1),r=(1-Math.abs(t))*(r>=0?1:-1));var o=Math.sqrt(t*t+r*r+n*n);return[t/o,r/o,n/o]}function b(e,t,r){return e[t]*r[0]+e[t+1]*r[1]+e[t+2]*r[2]}var M,I,T,A,S,O,L,P,E,j,G,_,D,k,V,N,C,B={quantizePositions:function(e,t,r,n){for(var o=r[0],i=r[1],a=r[2],s=65535,u=s/(r[3]-o),c=s/(r[4]-i),l=s/(r[5]-a),h=function(e){return e>=0?e:0},f=0;f<t;f+=3)n[f+0]=Math.floor(h(e[f+0]-o)*u),n[f+1]=Math.floor(h(e[f+1]-i)*c),n[f+2]=Math.floor(h(e[f+2]-a)*l)},compressPosition:function(e,t,r){var n=new Float32Array([t[3]!==t[0]?65535/(t[3]-t[0]):0,t[4]!==t[1]?65535/(t[4]-t[1]):0,t[5]!==t[2]?65535/(t[5]-t[2]):0]);r[0]=Math.floor((e[0]-t[0])*n[0]),r[1]=Math.floor((e[1]-t[1])*n[1]),r[2]=Math.floor((e[2]-t[2])*n[2])},createPositionsDecodeMatrix:(l=g.mat4(),h=g.mat4(),function(e,t){t=t||g.mat4();var r=e[0],n=e[1],o=e[2],i=e[3]-r,a=e[4]-n,s=e[5]-o,u=65535;return g.identityMat4(l),g.translationMat4v(e,l),g.identityMat4(h),g.scalingMat4v([i/u,a/u,s/u],h),g.mulMat4(l,h,t),t}),transformAndOctEncodeNormals:function(e,t,r,n,o){var i,a,s,u,c,l=g.vec3(),h=g.vec3();for(c=0;c<r;c+=3)l[0]=t[c],l[1]=t[c+1],l[2]=t[c+2],g.transformVec3(e,l,h),g.normalizeVec3(h,h),a=i=x(h,0,"floor","floor"),s=u=b(h,0,w(i)),(s=b(h,0,w(i=x(h,0,"ceil","floor"))))>u&&(a=i,u=s),(s=b(h,0,w(i=x(h,0,"floor","ceil"))))>u&&(a=i,u=s),(s=b(h,0,w(i=x(h,0,"ceil","ceil"))))>u&&(a=i,u=s),n[o+c+0]=a[0],n[o+c+1]=a[1],n[o+c+2]=0;return o+r},octEncodeNormals:function(e,t,r,n){for(var o,i,a,s,u=0;u<t;u+=3)i=o=x(e,u,"floor","floor"),a=s=b(e,u,w(o)),(a=b(e,u,w(o=x(e,u,"ceil","floor"))))>s&&(i=o,s=a),(a=b(e,u,w(o=x(e,u,"floor","ceil"))))>s&&(i=o,s=a),(a=b(e,u,w(o=x(e,u,"ceil","ceil"))))>s&&(i=o,s=a),r[n+u+0]=i[0],r[n+u+1]=i[1],r[n+u+2]=0;return n+t}},F=(M=[],I=[],T=[],A=[],S=[],O=0,L=new Uint16Array(3),P=new Uint16Array(3),E=new Uint16Array(3),j=g.vec3(),G=g.vec3(),_=g.vec3(),D=g.vec3(),k=g.vec3(),V=g.vec3(),N=g.vec3(),C=g.vec3(),function(e,t,r,n){!function(e,t){var r,n,o,i,a,s,u={},c=Math.pow(10,4),l=0;for(a=0,s=e.length;a<s;a+=3)r=e[a],n=e[a+1],o=e[a+2],void 0===u[i=Math.round(r*c)+"_"+Math.round(n*c)+"_"+Math.round(o*c)]&&(u[i]=l/3,M[l++]=r,M[l++]=n,M[l++]=o),I[a/3]=u[i];for(a=0,s=t.length;a<s;a++)A[a]=I[t[a]],T[A[a]]=t[a]}(e,t),function(e,t){O=0;for(var r=0,n=e;r<n;r+=3){var o=3*A[r],i=3*A[r+1],a=3*A[r+2];t?(L[0]=M[o],L[1]=M[o+1],L[2]=M[o+2],P[0]=M[i],P[1]=M[i+1],P[2]=M[i+2],E[0]=M[a],E[1]=M[a+1],E[2]=M[a+2],g.decompressPosition(L,t,j),g.decompressPosition(P,t,G),g.decompressPosition(E,t,_)):(j[0]=M[o],j[1]=M[o+1],j[2]=M[o+2],G[0]=M[i],G[1]=M[i+1],G[2]=M[i+2],_[0]=M[a],_[1]=M[a+1],_[2]=M[a+2]),g.subVec3(_,G,D),g.subVec3(j,G,k),g.cross3Vec3(D,k,V),g.normalizeVec3(V,N);var s=S[O]||(S[O]={normal:g.vec3()});s.normal[0]=N[0],s.normal[1]=N[1],s.normal[2]=N[2],O++}}(t.length,r);for(var o,i,a,s,u,c,l,h,f,d,p,v=[],m=Math.cos(g.DEGTORAD*n),y={},x=!1,w=0,b=t.length;w<b;w+=3)for(var B=w/3,F=0;F<3;F++)o=A[w+F],i=A[w+(F+1)%3],void 0===y[u=(a=Math.min(o,i))+","+(s=Math.max(o,i))]?y[u]={index1:a,index2:s,face1:B,face2:void 0}:y[u].face2=B;for(u in y){if(void 0!==(c=y[u]).face2){l=S[c.face1].normal,h=S[c.face2].normal,C[0]=-h[0],C[1]=-h[1],C[2]=-h[2],f=Math.abs(g.dotVec3(l,h));var U=Math.abs(g.dotVec3(l,C));if(f>m&&U>m)continue}d=T[c.index1],p=T[c.index2],(!x&&d>65535||p>65535)&&(x=!0),v.push(d),v.push(p)}return x?new Uint32Array(v):new Uint16Array(v)}),U=function(e,t,r,n){function o(e,r){for(var n,o,i=0;i<3;i++)if((n=t[3*e+i])!==(o=t[3*r+i]))return o-n;return 0}for(var i=e.slice().sort(o),a=null,s=0,u=i.length;s<u;s++)0!=s&&0==o(i[s],i[s-1])||(a=i[s]),r[i[s]]=a;for(var c=0,l=e.length;c<l;c+=3){var h=r[e[c]],f=r[e[c+1]],d=r[e[c+2]],p=h,v=f,m=d;if(h>f&&h>d?f>d?(p=h,v=f,m=d):(p=h,v=d,m=f):f>h&&f>d?h>d?(p=f,v=h,m=d):(p=f,v=d,m=h):d>h&&d>f&&(h>f?(p=d,v=h,m=f):(p=d,v=f,m=h)),n[c+0]=[p,v],n[c+1]=[v,m],p>m){var y=m;m=p,p=y}n[c+2]=[m,p]}function g(e,t){for(var r,n,o=0;o<2;o++)if(r=e[o],(n=t[o])!==r)return n-r;return 0}(n=n.slice(0,e.length)).sort(g);for(var x=0,w=0;w<n.length;w++)if(0===w||0!==g(n[w],n[w-1])){if(0!==w&&2!==x)return!1;x=1}else x++;return!(n.length>0&&2!==x)};function z(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function X(e,t,r){return t&&z(e.prototype,t),r&&z(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var R=X((function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.meshId=t.meshId,this.meshIndex=t.meshIndex,this.matrix=t.matrix,this.geometry=t.geometry,this.color=t.color||new Uint8Array([1,1,1]),this.metallic=null!==t.metallic&&void 0!==t.metallic?t.metallic:0,this.roughness=null!==t.roughness&&void 0!==t.roughness?t.roughness:1,this.opacity=void 0!==t.opacity&&null!==t.opacity?t.opacity:1,this.textureSet=t.textureSet,this.entity=null}));function K(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var q=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.geometryId=t.geometryId,this.primitiveType=t.primitiveType,this.geometryIndex=t.geometryIndex,this.numInstances=0,this.positions=t.positions,this.positionsQuantized=new Uint16Array(t.positions.length),this.normals=t.normals,this.normalsOctEncoded=null,this.colorsCompressed=t.colorsCompressed,this.uvs=t.uvs,this.uvsCompressed=t.uvsCompressed,this.indices=t.indices,this.edgeIndices=t.edgeIndices,this.solid=!1}var t,r;return t=e,(r=[{key:"reused",get:function(){return this.numInstances>1}}])&&K(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Z(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Y(e,t,r){return t&&Z(e.prototype,t),r&&Z(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var Q=Y((function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.entityId=t,this.entityIndex=null,this.meshes=r,this.aabb=g.AABB3(),this.hasReusedGeometries=!1}));function W(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function J(e,t,r){return t&&W(e.prototype,t),r&&W(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var H=J((function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.aabb=t,this.entities=r}));function $(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ee(e,t,r){return t&&$(e.prototype,t),r&&$(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var te=ee((function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.aabb=t,this.entities=null,this.left=null,this.right=null}));function re(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ne(e,t,r){return t&&re(e.prototype,t),r&&re(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var oe=ne((function e(t,r,n,o,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.metaObjectId=t,this.propertySetIds=r,this.metaObjectType=n,this.metaObjectName=o,this.parentMetaObjectId=i}));function ie(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ae(e,t,r){return t&&ie(e.prototype,t),r&&ie(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var se=ae((function e(t,r,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.propertySetId=t,this.propertySetType=r,this.propertySetName=n,this.properties=o}));function ue(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ce(e,t,r){return t&&ue(e.prototype,t),r&&ue(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var le=ce((function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.textureId=t.textureId,this.textureIndex=t.textureIndex,this.imageData=t.imageData,this.channel=null,this.width=t.width,this.height=t.height,this.src=t.src}));function he(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function fe(e,t,r){return t&&he(e.prototype,t),r&&he(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var de=fe((function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.textureSetId=t.textureSetId,this.textureSetIndex=t.textureSetIndex,this.materialType=t.materialType,this.materialIndex=t.materialIndex,this.numInstances=0,this.colorTexture=t.colorTexture,this.metallicRoughnessTexture=t.metallicRoughnessTexture,this.normalsTexture=t.normalsTexture,this.emissiveTexture=t.emissiveTexture,this.occlusionTexture=t.occlusionTexture}));const pe=require("@loaders.gl/core"),ve=require("@loaders.gl/textures"),me=require("@loaders.gl/images");function ye(e){return ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ye(e)}function ge(){ge=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var o=t&&t.prototype instanceof h?t:h,i=Object.create(o.prototype),a=new I(n||[]);return i._invoke=function(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=c(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(e,r,a),i}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var l={};function h(){}function f(){}function d(){}var p={};s(p,o,(function(){return this}));var v=Object.getPrototypeOf,m=v&&v(v(T([])));m&&m!==t&&r.call(m,o)&&(p=m);var y=d.prototype=h.prototype=Object.create(p);function g(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(o,i,a,s){var u=c(e[o],e,i);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==ye(h)&&r.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(h).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,s)}))}s(u.arg)}var o;this._invoke=function(e,r){function i(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(i,i):i()}}function w(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function T(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:A}}function A(){return{value:void 0,done:!0}}return f.prototype=d,s(y,"constructor",d),s(d,"constructor",f),f.displayName=s(d,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,s(e,a,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},g(x.prototype),s(x.prototype,i,(function(){return this})),e.AsyncIterator=x,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new x(u(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},g(y),s(y,a,"Generator"),s(y,o,(function(){return this})),s(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=T,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(M),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),M(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;M(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:T(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}function xe(e,t,r,n,o,i,a){try{var s=e[i](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function we(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function be(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Me=g.vec4([0,0,0,1]),Ie=g.vec4([0,0,0,1]),Te=g.mat4(),Ae=g.mat4(),Se=new Float64Array(3),Oe={0:{useSRGB:!0,qualityLevel:50,encodeUASTC:!0,mipmaps:!0},3:{useSRGB:!0,encodeUASTC:!0,qualityLevel:10,mipmaps:!1},1:{useSRGB:!1,encodeUASTC:!0,qualityLevel:50,mipmaps:!0},2:{useSRGB:!1,encodeUASTC:!0,qualityLevel:10,mipmaps:!1},4:{useSRGB:!1,encodeUASTC:!0,qualityLevel:10,mipmaps:!1}},Le=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};we(this,e),this.modelId=t.modelId||"default",this.projectId=t.projectId||"",this.revisionId=t.revisionId||"",this.author=t.author||"",this.createdAt=t.createdAt||"",this.creatingApplication=t.creatingApplication||"",this.schema=t.schema||"",this.xktVersion=f.xktVersion,this.edgeThreshold=t.edgeThreshold||10,this.minTileSize=t.minTileSize||1e3,this.propertySets={},this.propertySetsList=[],this.metaObjects={},this.metaObjectsList=[],this.reusedGeometriesDecodeMatrix=new Float32Array(16),this.geometries={},this.geometriesList=[],this.textures={},this.texturesList=[],this.textureSets={},this.textureSetsList=[],this.meshes={},this.meshesList=[],this.entities={},this.entitiesList=[],this.tilesList=[],this.aabb=g.AABB3(),this.finalized=!1}var t,r,n,o;return t=e,r=[{key:"createPropertySet",value:function(e){if(!e)throw"Parameters expected: params";if(null===e.propertySetId||void 0===e.propertySetId)throw"Parameter expected: params.propertySetId";if(null===e.properties||void 0===e.properties)throw"Parameter expected: params.properties";if(this.finalized)console.error("XKTModel has been finalized, can't add more property sets");else if(!this.propertySets[e.propertySetId]){var t=e.propertySetId,r=e.propertySetType||"Default",n=e.propertySetName||e.propertySetId,o=e.properties||[],i=new se(t,r,n,o);return this.propertySets[t]=i,this.propertySetsList.push(i),i}}},{key:"createMetaObject",value:function(e){if(!e)throw"Parameters expected: params";if(null===e.metaObjectId||void 0===e.metaObjectId)throw"Parameter expected: params.metaObjectId";if(this.finalized)console.error("XKTModel has been finalized, can't add more meta objects");else if(!this.metaObjects[e.metaObjectId]){var t=e.metaObjectId,r=e.propertySetIds,n=e.metaObjectType||"Default",o=e.metaObjectName||e.metaObjectId,i=e.parentMetaObjectId,a=new oe(t,r,n,o,i);return this.metaObjects[t]=a,this.metaObjectsList.push(a),i||this._rootMetaObject||(this._rootMetaObject=a),a}}},{key:"createTexture",value:function(e){if(!e)throw"Parameters expected: params";if(null===e.textureId||void 0===e.textureId)throw"Parameter expected: params.textureId";if(!e.imageData&&!e.src)throw"Parameter expected: params.imageData or params.src";if(this.finalized)console.error("XKTModel has been finalized, can't add more textures");else{if(!this.textures[e.textureId]){if(e.src){var t=e.src.split(".").pop();if("jpg"!==t&&"jpeg"!==t&&"png"!==t)return void console.error("XKTModel does not support image files with extension '".concat(t,"' - won't create texture '").concat(e.textureId))}var r=e.textureId,n=e.imageData,o=e.width,i=e.height,a=e.src,s=new le({textureId:r,imageData:n,width:o,height:i,src:a});return this.textures[r]=s,this.texturesList.push(s),s}console.error("XKTTexture already exists with this ID: "+e.textureId)}}},{key:"createTextureSet",value:function(e){if(!e)throw"Parameters expected: params";if(null===e.textureSetId||void 0===e.textureSetId)throw"Parameter expected: params.textureSetId";if(this.finalized)console.error("XKTModel has been finalized, can't add more textureSets");else{if(!this.textureSets[e.textureSetId]){var t,r,n,o,i;if(void 0!==e.colorTextureId&&null!==e.colorTextureId){if(!(t=this.textures[e.colorTextureId]))return void console.error("Texture not found: ".concat(e.colorTextureId," - ensure that you create it first with createTexture()"));t.channel=0}if(void 0!==e.metallicRoughnessTextureId&&null!==e.metallicRoughnessTextureId){if(!(r=this.textures[e.metallicRoughnessTextureId]))return void console.error("Texture not found: ".concat(e.metallicRoughnessTextureId," - ensure that you create it first with createTexture()"));r.channel=1}if(void 0!==e.normalsTextureId&&null!==e.normalsTextureId){if(!(n=this.textures[e.normalsTextureId]))return void console.error("Texture not found: ".concat(e.normalsTextureId," - ensure that you create it first with createTexture()"));n.channel=2}if(void 0!==e.emissiveTextureId&&null!==e.emissiveTextureId){if(!(o=this.textures[e.emissiveTextureId]))return void console.error("Texture not found: ".concat(e.emissiveTextureId," - ensure that you create it first with createTexture()"));o.channel=3}if(void 0!==e.occlusionTextureId&&null!==e.occlusionTextureId){if(!(i=this.textures[e.occlusionTextureId]))return void console.error("Texture not found: ".concat(e.occlusionTextureId," - ensure that you create it first with createTexture()"));i.channel=4}var a=new de({textureSetId:e.textureSetId,textureSetIndex:this.textureSetsList.length,colorTexture:t,metallicRoughnessTexture:r,normalsTexture:n,emissiveTexture:o,occlusionTexture:i});return this.textureSets[e.textureSetId]=a,this.textureSetsList.push(a),a}console.error("XKTTextureSet already exists with this ID: "+e.textureSetId)}}},{key:"createGeometry",value:function(e){if(!e)throw"Parameters expected: params";if(null===e.geometryId||void 0===e.geometryId)throw"Parameter expected: params.geometryId";if(!e.primitiveType)throw"Parameter expected: params.primitiveType";if(!e.positions)throw"Parameter expected: params.positions";var t="triangles"===e.primitiveType,r="points"===e.primitiveType,n="lines"===e.primitiveType;if(!t&&!r&&!n)throw"Unsupported value for params.primitiveType: "+e.primitiveType+"' - supported values are 'triangles', 'points' and 'lines'";if(t&&!e.indices)throw"Parameter expected for 'triangles' primitive: params.indices";if(r&&!e.colors&&!e.colorsCompressed)throw"Parameter expected for 'points' primitive: params.colors or params.colorsCompressed";if(n&&!e.indices)throw"Parameter expected for 'lines' primitive: params.indices";if(this.finalized)console.error("XKTModel has been finalized, can't add more geometries");else{if(!this.geometries[e.geometryId]){var o=e.geometryId,i=e.primitiveType,a=new Float64Array(e.positions),s={geometryId:o,geometryIndex:this.geometriesList.length,primitiveType:i,positions:a,uvs:e.uvs||e.uv};if(t&&(e.normals&&(s.normals=new Float32Array(e.normals)),s.indices=e.indices),r)if(e.colorsCompressed)s.colorsCompressed=new Uint8Array(e.colorsCompressed);else{for(var u=e.colors,c=new Uint8Array(u.length),l=0,h=u.length;l<h;l++)c[l]=Math.floor(255*u[l]);s.colorsCompressed=c}if(n&&(s.indices=e.indices),t){if(!e.normals){var f=[],d=[];!function(e,t,r,n){for(var o={},i=[],a=Math.pow(10,4),s=0,u=e.length;s<u;s+=3){var c=e[s],l=e[s+1],h=e[s+2],f="".concat(Math.round(c*a),"_").concat(Math.round(l*a),"_").concat(Math.round(h*a));void 0===o[f]&&(o[f]=r.length/3,r.push(c),r.push(l),r.push(h)),i[s/3]=o[f]}for(var d=0,p=t.length;d<p;d++)n[d]=i[t[d]]}(s.positions,s.indices,f,d),s.positions=new Float64Array(f),s.indices=d}s.edgeIndices=F(s.positions,s.indices,null,e.edgeThreshold||this.edgeThreshold||10)}var p=new q(s);return this.geometries[o]=p,this.geometriesList.push(p),p}console.error("XKTGeometry already exists with this ID: "+e.geometryId)}}},{key:"createMesh",value:function(e){if(null===e.meshId||void 0===e.meshId)throw"Parameter expected: params.meshId";if(null===e.geometryId||void 0===e.geometryId)throw"Parameter expected: params.geometryId";if(this.finalized)throw"XKTModel has been finalized, can't add more meshes";if(this.meshes[e.meshId])console.error("XKTMesh already exists with this ID: "+e.meshId);else{var t=this.geometries[e.geometryId];if(t){t.numInstances++;var r=null;if(e.textureSetId){if(!(r=this.textureSets[e.textureSetId]))return void console.error("XKTTextureSet not found: "+e.textureSetId);r.numInstances++}var n=e.matrix;if(!n){var o=e.position,i=e.scale,a=e.rotation;if(o||i||a){n=g.identityMat4();var s=g.eulerToQuaternion(a||[0,0,0],"XYZ",g.identityQuaternion());g.composeMat4(o||[0,0,0],s,i||[1,1,1],n)}else n=g.identityMat4()}var u=this.meshesList.length,c=new R({meshId:e.meshId,meshIndex:u,matrix:n,geometry:t,color:e.color,metallic:e.metallic,roughness:e.roughness,opacity:e.opacity,textureSet:r});return this.meshes[c.meshId]=c,this.meshesList.push(c),c}console.error("XKTGeometry not found: "+e.geometryId)}}},{key:"createEntity",value:function(e){if(!e)throw"Parameters expected: params";if(null===e.entityId||void 0===e.entityId)throw"Parameter expected: params.entityId";if(!e.meshIds)throw"Parameter expected: params.meshIds";if(this.finalized)console.error("XKTModel has been finalized, can't add more entities");else{if(0!==e.meshIds.length){var t=e.entityId;if(this.entities[t]){for(;this.entities[t];)t=g.createUUID();console.error("XKTEntity already exists with this ID: "+e.entityId+" - substituting random ID instead: "+t)}for(var r=e.meshIds,n=[],o=0,i=r.length;o<i;o++){var a=r[o],s=this.meshes[a];s?s.entity?console.error("XKTMesh "+a+" already used by XKTEntity "+s.entity.entityId):n.push(s):console.error("XKTMesh found: "+a)}for(var u=new Q(t,n),c=0,l=n.length;c<l;c++)n[c].entity=u;return this.entities[t]=u,this.entitiesList.push(u),u}console.warn("XKTEntity has no meshes - won't create: "+e.entityId)}}},{key:"createDefaultMetaObjects",value:function(){for(var e=0,t=this.entitiesList.length;e<t;e++){var r=this.entitiesList[e].entityId;this.metaObjects[r]||(this._rootMetaObject||(this._rootMetaObject=this.createMetaObject({metaObjectId:this.modelId,metaObjectType:"Default",metaObjectName:this.modelId})),this.createMetaObject({metaObjectId:r,metaObjectType:"Default",metaObjectName:""+r,parentMetaObjectId:this._rootMetaObject.metaObjectId}))}}},{key:"finalize",value:(n=ge().mark((function e(){var t;return ge().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.finalized){e.next=3;break}return console.log("XKTModel already finalized"),e.abrupt("return");case 3:return this._removeUnusedTextures(),e.next=6,this._compressTextures();case 6:this._bakeSingleUseGeometryPositions(),this._bakeAndOctEncodeNormals(),this._createEntityAABBs(),t=this._createKDTree(),this.entitiesList=[],this._createTilesFromKDTree(t),this._createReusedGeometriesDecodeMatrix(),this._flagSolidGeometries(),this.aabb.set(t.aabb),this.finalized=!0;case 16:case"end":return e.stop()}}),e,this)})),o=function(){var e=this,t=arguments;return new Promise((function(r,o){var i=n.apply(e,t);function a(e){xe(i,r,o,a,s,"next",e)}function s(e){xe(i,r,o,a,s,"throw",e)}a(void 0)}))},function(){return o.apply(this,arguments)})},{key:"_removeUnusedTextures",value:function(){for(var e=[],t={},r=0,n=this.texturesList.length;r<n;r++){var o=this.texturesList[r];null!==o.channel&&(o.textureIndex=e.length,e.push(o),t[o.textureId]=o)}this.texturesList=e,this.textures=t}},{key:"_compressTextures",value:function(){var e=this,t=this.texturesList.length;return new Promise((function(r){if(0!==t)for(var n=function(n,o){var i=e.texturesList[n],a=Oe[i.channel]||{};if(i.src){var s=i.src;switch(s.split(".").pop()){case"jpeg":case"jpg":case"png":(0,pe.load)(s,me.ImageLoader,{image:{type:"data",mipLevels:"auto",resizeQuality:"low",colorSpaceConversion:"default",premultiplyAlpha:"none"}}).then((function(e){(0,pe.encode)(e,ve.KTX2BasisWriter,a).then((function(e){var n=new Uint8Array(e);i.imageData=n,--t<=0&&r()})).catch((function(e){console.error("[XKTModel.finalize] Failed to encode image: "+e),--t<=0&&r()}))})).catch((function(e){console.error("[XKTModel.finalize] Failed to load image: "+e),--t<=0&&r()}));break;default:--t<=0&&r()}}i.imageData&&(0,pe.encode)(i.imageData,ve.KTX2BasisWriter,a).then((function(e){i.imageData=new Uint8Array(e),--t<=0&&r()})).catch((function(e){console.error("[XKTModel.finalize] Failed to encode image: "+e),--t<=0&&r()}))},o=0,i=e.texturesList.length;o<i;o++)n(o);else r()}))}},{key:"_bakeSingleUseGeometryPositions",value:function(){for(var e=0,t=this.meshesList.length;e<t;e++){var r=this.meshesList[e],n=r.geometry;if(1===n.numInstances){var o=r.matrix;if(o&&!g.isIdentityMat4(o))for(var i=n.positions,a=0,s=i.length;a<s;a+=3)Me[0]=i[a+0],Me[1]=i[a+1],Me[2]=i[a+2],Me[3]=1,g.transformPoint4(o,Me,Ie),i[a+0]=Ie[0],i[a+1]=Ie[1],i[a+2]=Ie[2]}}}},{key:"_bakeAndOctEncodeNormals",value:function(){for(var e=0,t=this.meshesList.length;e<t;e++){var r=this.meshesList[e],n=r.geometry;if(n.normals&&!n.normalsOctEncoded)if(n.normalsOctEncoded=new Int8Array(n.normals.length),n.numInstances>1)B.octEncodeNormals(n.normals,n.normals.length,n.normalsOctEncoded,0);else{var o=g.inverseMat4(g.transposeMat4(r.matrix,Te),Ae);B.transformAndOctEncodeNormals(o,n.normals,n.normals.length,n.normalsOctEncoded,0)}}}},{key:"_createEntityAABBs",value:function(){for(var e=0,t=this.entitiesList.length;e<t;e++){var r=this.entitiesList[e],n=r.aabb,o=r.meshes;g.collapseAABB3(n);for(var i=0,a=o.length;i<a;i++){var s=o[i],u=s.geometry,c=s.matrix;if(u.numInstances>1)for(var l=u.positions,h=0,f=l.length;h<f;h+=3)Me[0]=l[h+0],Me[1]=l[h+1],Me[2]=l[h+2],Me[3]=1,g.transformPoint4(c,Me,Ie),g.expandAABB3Point3(n,Ie);else for(var d=u.positions,p=0,v=d.length;p<v;p+=3)Me[0]=d[p+0],Me[1]=d[p+1],Me[2]=d[p+2],g.expandAABB3Point3(n,Me)}}}},{key:"_createKDTree",value:function(){for(var e=g.collapseAABB3(),t=0,r=this.entitiesList.length;t<r;t++){var n=this.entitiesList[t];g.expandAABB3(e,n.aabb)}for(var o=new te(e),i=0,a=this.entitiesList.length;i<a;i++){var s=this.entitiesList[i];this._insertEntityIntoKDTree(o,s)}return o}},{key:"_insertEntityIntoKDTree",value:function(e,t){var r=e.aabb,n=t.aabb;if(g.getAABB3Diag(r)<this.minTileSize)return e.entities=e.entities||[],e.entities.push(t),void g.expandAABB3(r,n);if(e.left&&g.containsAABB3(e.left.aabb,n))this._insertEntityIntoKDTree(e.left,t);else if(e.right&&g.containsAABB3(e.right.aabb,n))this._insertEntityIntoKDTree(e.right,t);else{Se[0]=r[3]-r[0],Se[1]=r[4]-r[1],Se[2]=r[5]-r[2];var o=0;if(Se[1]>Se[o]&&(o=1),Se[2]>Se[o]&&(o=2),!e.left){var i=r.slice();if(i[o+3]=(r[o]+r[o+3])/2,e.left=new te(i),g.containsAABB3(i,n))return void this._insertEntityIntoKDTree(e.left,t)}if(!e.right){var a=r.slice();if(a[o]=(r[o]+r[o+3])/2,e.right=new te(a),g.containsAABB3(a,n))return void this._insertEntityIntoKDTree(e.right,t)}e.entities=e.entities||[],e.entities.push(t),g.expandAABB3(r,n)}}},{key:"_createTilesFromKDTree",value:function(e){this._createTilesFromKDNode(e)}},{key:"_createTilesFromKDNode",value:function(e){e.entities&&e.entities.length>0&&this._createTileFromEntities(e.entities),e.left&&this._createTilesFromKDNode(e.left),e.right&&this._createTilesFromKDNode(e.right)}},{key:"_createTileFromEntities",value:function(e){var t=g.AABB3();g.collapseAABB3(t);for(var r=0;r<e.length;r++){var n=e[r];g.expandAABB3(t,n.aabb)}var o=g.getAABB3Center(t),i=g.mulVec3Scalar(o,-1,g.vec3()),a=g.AABB3();a[0]=t[0]-o[0],a[1]=t[1]-o[1],a[2]=t[2]-o[2],a[3]=t[3]-o[0],a[4]=t[4]-o[1],a[5]=t[5]-o[2];for(var s=0;s<e.length;s++){for(var u=e[s],c=u.meshes,l=0,h=c.length;l<h;l++){var f=c[l],d=f.geometry;if(d.reused)g.translateMat4v(i,f.matrix);else{for(var p=d.positions,v=0,m=p.length;v<m;v+=3)p[v+0]-=o[0],p[v+1]-=o[1],p[v+2]-=o[2];B.quantizePositions(p,p.length,a,d.positionsQuantized)}}u.entityIndex=this.entitiesList.length,this.entitiesList.push(u)}var y=new H(t,e);this.tilesList.push(y)}},{key:"_createReusedGeometriesDecodeMatrix",value:function(){for(var e=g.vec3(),t=g.collapseAABB3(g.AABB3()),r=0,n=0,o=this.geometriesList.length;n<o;n++){var i=this.geometriesList[n];if(i.reused){for(var a=i.positions,s=0,u=a.length;s<u;s+=3)e[0]=a[s],e[1]=a[s+1],e[2]=a[s+2],g.expandAABB3Point3(t,e);r++}}if(r>0){B.createPositionsDecodeMatrix(t,this.reusedGeometriesDecodeMatrix);for(var c=0,l=this.geometriesList.length;c<l;c++){var h=this.geometriesList[c];h.reused&&B.quantizePositions(h.positions,h.positions.length,t,h.positionsQuantized)}}else g.identityMat4(this.reusedGeometriesDecodeMatrix)}},{key:"_flagSolidGeometries",value:function(){for(var e=0,t=0,r=0,n=this.geometriesList.length;r<n;r++){var o=this.geometriesList[r];"triangles"===o.primitiveType&&(o.positionsQuantized.length>e&&(e=o.positionsQuantized.length),o.indices.length>t&&(t=o.indices.length))}for(var i=new Array(e/3),a=new Array(t),s=0,u=this.geometriesList.length;s<u;s++){var c=this.geometriesList[s];"triangles"===c.primitiveType&&(c.solid=U(c.indices,c.positionsQuantized,i,a))}}}],r&&be(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();const Pe=require("pako");var Ee=f.xktVersion;function je(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Ge(e),n=_e(r);t.texturesSize+=n.textureData.byteLength;var o=De(n);return o}function Ge(e){for(var t=e.propertySetsList,r=e.metaObjectsList,n=e.geometriesList,o=e.texturesList,i=e.textureSetsList,a=e.meshesList,s=e.entitiesList,u=e.tilesList,c=t.length,l=r.length,h=n.length,f=o.length,d=i.length,p=a.length,v=s.length,m=u.length,y=0,g=0,x=0,w=0,b=0,M=0,I=0,T=0,A=0;A<h;A++){var S=n[A];S.positionsQuantized&&(y+=S.positionsQuantized.length),S.normalsOctEncoded&&(g+=S.normalsOctEncoded.length),S.colorsCompressed&&(x+=S.colorsCompressed.length),S.uvs&&(w+=S.uvs.length),S.indices&&(b+=S.indices.length),S.edgeIndices&&(M+=S.edgeIndices.length)}for(var O=0;O<f;O++)T+=o[O].imageData.byteLength;for(var L=0;L<p;L++)a[L].geometry.numInstances>1&&(I+=16);var P={metadata:{},textureData:new Uint8Array(T),eachTextureDataPortion:new Uint32Array(f),eachTextureDimensions:new Uint16Array(2*f),positions:new Uint16Array(y),normals:new Int8Array(g),colors:new Uint8Array(x),uvs:new Float32Array(w),indices:new Uint32Array(b),edgeIndices:new Uint32Array(M),eachTextureSetTextures:new Int32Array(5*d),matrices:new Float32Array(I),reusedGeometriesDecodeMatrix:new Float32Array(e.reusedGeometriesDecodeMatrix),eachGeometryPrimitiveType:new Uint8Array(h),eachGeometryPositionsPortion:new Uint32Array(h),eachGeometryNormalsPortion:new Uint32Array(h),eachGeometryColorsPortion:new Uint32Array(h),eachGeometryUVsPortion:new Uint32Array(h),eachGeometryIndicesPortion:new Uint32Array(h),eachGeometryEdgeIndicesPortion:new Uint32Array(h),eachMeshGeometriesPortion:new Uint32Array(p),eachMeshMatricesPortion:new Uint32Array(p),eachMeshTextureSet:new Int32Array(p),eachMeshMaterialAttributes:new Uint8Array(6*p),eachEntityId:[],eachEntityMeshesPortion:new Uint32Array(v),eachTileAABB:new Float64Array(6*m),eachTileEntitiesPortion:new Uint32Array(m)},E=0,j=0,G=0,_=0,D=0,k=0;P.metadata={id:e.modelId,projectId:e.projectId,revisionId:e.revisionId,author:e.author,createdAt:e.createdAt,creatingApplication:e.creatingApplication,schema:e.schema,propertySets:[],metaObjects:[]};for(var V=0;V<c;V++){var N=t[V],C={id:""+N.propertySetId,name:N.propertySetName,type:N.propertySetType,properties:N.properties};P.metadata.propertySets.push(C)}for(var B=0;B<l;B++){var F=r[B],U={name:F.metaObjectName,type:F.metaObjectType,id:""+F.metaObjectId};void 0!==F.parentMetaObjectId&&null!==F.parentMetaObjectId&&(U.parent=""+F.parentMetaObjectId),F.propertySetIds&&F.propertySetIds.length>0&&(U.propertySetIds=F.propertySetIds),P.metadata.metaObjects.push(U)}for(var z=0;z<h;z++){var X=n[z],R="triangles"===X.primitiveType?X.solid?0:1:"points"===X.primitiveType?2:3;P.eachGeometryPrimitiveType[z]=R,P.eachGeometryPositionsPortion[z]=E,P.eachGeometryNormalsPortion[z]=j,P.eachGeometryColorsPortion[z]=G,P.eachGeometryUVsPortion[z]=_,P.eachGeometryIndicesPortion[z]=D,P.eachGeometryEdgeIndicesPortion[z]=k,X.positionsQuantized&&(P.positions.set(X.positionsQuantized,E),E+=X.positionsQuantized.length),X.normalsOctEncoded&&(P.normals.set(X.normalsOctEncoded,j),j+=X.normalsOctEncoded.length),X.colorsCompressed&&(P.colors.set(X.colorsCompressed,G),G+=X.colorsCompressed.length),X.uvs&&(P.uvs.set(X.uvs,_),_+=X.uvs.length),X.indices&&(P.indices.set(X.indices,D),D+=X.indices.length),X.edgeIndices&&(P.edgeIndices.set(X.edgeIndices,k),k+=X.edgeIndices.length)}for(var K=0,q=e.texturesList.length,Z=0;K<q;K++){var Y=e.texturesList[K],Q=Y.imageData;P.textureData.set(Q,Z),P.eachTextureDataPortion[K]=Z,P.eachTextureDimensions[2*K]=Y.width,P.eachTextureDimensions[2*K+1]=Y.height,Z+=Q.byteLength}for(var W=0,J=e.textureSetsList.length,H=0;W<J;W++){var $=i[W];P.eachTextureSetTextures[H++]=$.colorTexture?$.colorTexture.textureIndex:-1,P.eachTextureSetTextures[H++]=$.metallicRoughnessTexture?$.metallicRoughnessTexture.textureIndex:-1,P.eachTextureSetTextures[H++]=$.normalsTexture?$.normalsTexture.textureIndex:-1,P.eachTextureSetTextures[H++]=$.emissiveTexture?$.emissiveTexture.textureIndex:-1,P.eachTextureSetTextures[H++]=$.occlusionTexture?$.occlusionTexture.textureIndex:-1}for(var ee=0,te=0,re=0;ee<p;ee++){var ne=a[ee];ne.geometry.numInstances>1&&(P.matrices.set(ne.matrix,te),P.eachMeshMatricesPortion[ee]=te,te+=16),P.eachMeshTextureSet[ee]=ne.textureSet?ne.textureSet.textureSetIndex:-1,P.eachMeshMaterialAttributes[re++]=255*ne.color[0],P.eachMeshMaterialAttributes[re++]=255*ne.color[1],P.eachMeshMaterialAttributes[re++]=255*ne.color[2],P.eachMeshMaterialAttributes[re++]=255*ne.opacity,P.eachMeshMaterialAttributes[re++]=255*ne.metallic,P.eachMeshMaterialAttributes[re++]=255*ne.roughness}for(var oe=0,ie=0,ae=0;ae<m;ae++){var se=u[ae],ue=se.entities,ce=ue.length;if(0!==ce){P.eachTileEntitiesPortion[ae]=oe;for(var le=se.aabb,he=0;he<ce;he++){for(var fe=ue[he],de=fe.meshes,pe=de.length,ve=0;ve<pe;ve++){var me=de[ve].geometry.geometryIndex;P.eachMeshGeometriesPortion[ie+ve]=me}P.eachEntityId[oe]=fe.entityId,P.eachEntityMeshesPortion[oe]=ie,oe++,ie+=pe}var ye=6*ae;P.eachTileAABB.set(le,ye)}}return P}function _e(e){return{metadata:Pe.deflate((t=e.metadata,JSON.stringify(t).replace(/[\u007F-\uFFFF]/g,(function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).substr(-4)})))),textureData:Pe.deflate(e.textureData.buffer),eachTextureDataPortion:Pe.deflate(e.eachTextureDataPortion.buffer),eachTextureDimensions:Pe.deflate(e.eachTextureDimensions.buffer),positions:Pe.deflate(e.positions.buffer),normals:Pe.deflate(e.normals.buffer),colors:Pe.deflate(e.colors.buffer),uvs:Pe.deflate(e.uvs.buffer),indices:Pe.deflate(e.indices.buffer),edgeIndices:Pe.deflate(e.edgeIndices.buffer),eachTextureSetTextures:Pe.deflate(e.eachTextureSetTextures.buffer),matrices:Pe.deflate(e.matrices.buffer),reusedGeometriesDecodeMatrix:Pe.deflate(e.reusedGeometriesDecodeMatrix.buffer),eachGeometryPrimitiveType:Pe.deflate(e.eachGeometryPrimitiveType.buffer),eachGeometryPositionsPortion:Pe.deflate(e.eachGeometryPositionsPortion.buffer),eachGeometryNormalsPortion:Pe.deflate(e.eachGeometryNormalsPortion.buffer),eachGeometryColorsPortion:Pe.deflate(e.eachGeometryColorsPortion.buffer),eachGeometryUVsPortion:Pe.deflate(e.eachGeometryUVsPortion.buffer),eachGeometryIndicesPortion:Pe.deflate(e.eachGeometryIndicesPortion.buffer),eachGeometryEdgeIndicesPortion:Pe.deflate(e.eachGeometryEdgeIndicesPortion.buffer),eachMeshGeometriesPortion:Pe.deflate(e.eachMeshGeometriesPortion.buffer),eachMeshMatricesPortion:Pe.deflate(e.eachMeshMatricesPortion.buffer),eachMeshTextureSet:Pe.deflate(e.eachMeshTextureSet.buffer),eachMeshMaterialAttributes:Pe.deflate(e.eachMeshMaterialAttributes.buffer),eachEntityId:Pe.deflate(JSON.stringify(e.eachEntityId).replace(/[\u007F-\uFFFF]/g,(function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).substr(-4)}))),eachEntityMeshesPortion:Pe.deflate(e.eachEntityMeshesPortion.buffer),eachTileAABB:Pe.deflate(e.eachTileAABB.buffer),eachTileEntitiesPortion:Pe.deflate(e.eachTileEntitiesPortion.buffer)};var t}function De(e){return function(e){var t=new Uint32Array(e.length+2);t[0]=Ee,t[1]=e.length;for(var r=0,n=0,o=e.length;n<o;n++){var i=e[n].length;t[n+2]=i,r+=i}var a=new Uint8Array(t.buffer),s=new Uint8Array(a.length+r);s.set(a);for(var u=a.length,c=0,l=e.length;c<l;c++){var h=e[c];s.set(h,u),u+=h.length}return s.buffer}([e.metadata,e.textureData,e.eachTextureDataPortion,e.eachTextureDimensions,e.positions,e.normals,e.colors,e.uvs,e.indices,e.edgeIndices,e.eachTextureSetTextures,e.matrices,e.reusedGeometriesDecodeMatrix,e.eachGeometryPrimitiveType,e.eachGeometryPositionsPortion,e.eachGeometryNormalsPortion,e.eachGeometryColorsPortion,e.eachGeometryUVsPortion,e.eachGeometryIndicesPortion,e.eachGeometryEdgeIndicesPortion,e.eachMeshGeometriesPortion,e.eachMeshMatricesPortion,e.eachMeshTextureSet,e.eachMeshMaterialAttributes,e.eachEntityId,e.eachEntityMeshesPortion,e.eachTileAABB,e.eachTileEntitiesPortion])}function ke(e,t,r){r=r||2;var n,o,i,a,s,u,c,l=t&&t.length,h=l?t[0]*r:e.length,f=Ve(e,0,h,r,!0),d=[];if(!f||f.next===f.prev)return d;if(l&&(f=function(e,t,r,n){var o,i,a,s=[];for(o=0,i=t.length;o<i;o++)(a=Ve(e,t[o]*n,o<i-1?t[o+1]*n:e.length,n,!1))===a.next&&(a.steiner=!0),s.push(Ze(a));for(s.sort(Xe),o=0;o<s.length;o++)Re(s[o],r),r=Ne(r,r.next);return r}(e,t,f,r)),e.length>80*r){n=i=e[0],o=a=e[1];for(var p=r;p<h;p+=r)(s=e[p])<n&&(n=s),(u=e[p+1])<o&&(o=u),s>i&&(i=s),u>a&&(a=u);c=0!==(c=Math.max(i-n,a-o))?1/c:0}return Ce(f,d,r,n,o,c),d}function Ve(e,t,r,n,o){var i,a;if(o===at(e,t,r,n)>0)for(i=t;i<r;i+=n)a=nt(i,e[i],e[i+1],a);else for(i=r-n;i>=t;i-=n)a=nt(i,e[i],e[i+1],a);return a&&Je(a,a.next)&&(ot(a),a=a.next),a}function Ne(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!Je(n,n.next)&&0!==We(n.prev,n,n.next))n=n.next;else{if(ot(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function Ce(e,t,r,n,o,i,a){if(e){!a&&i&&function(e,t,r,n){var o=e;do{null===o.z&&(o.z=qe(o.x,o.y,t,r,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==e);o.prevZ.nextZ=null,o.prevZ=null,function(e){var t,r,n,o,i,a,s,u,c=1;do{for(r=e,e=null,i=null,a=0;r;){for(a++,n=r,s=0,t=0;t<c&&(s++,n=n.nextZ);t++);for(u=c;s>0||u>0&&n;)0!==s&&(0===u||!n||r.z<=n.z)?(o=r,r=r.nextZ,s--):(o=n,n=n.nextZ,u--),i?i.nextZ=o:e=o,o.prevZ=i,i=o;r=n}i.nextZ=null,c*=2}while(a>1)}(o)}(e,n,o,i);for(var s,u,c=e;e.prev!==e.next;)if(s=e.prev,u=e.next,i?Fe(e,n,o,i):Be(e))t.push(s.i/r),t.push(e.i/r),t.push(u.i/r),ot(e),e=u.next,c=u.next;else if((e=u)===c){a?1===a?Ce(e=Ue(Ne(e),t,r),t,r,n,o,i,2):2===a&&ze(e,t,r,n,o,i):Ce(Ne(e),t,r,n,o,i,1);break}}}function Be(e){var t=e.prev,r=e,n=e.next;if(We(t,r,n)>=0)return!1;for(var o=e.next.next;o!==e.prev;){if(Ye(t.x,t.y,r.x,r.y,n.x,n.y,o.x,o.y)&&We(o.prev,o,o.next)>=0)return!1;o=o.next}return!0}function Fe(e,t,r,n){var o=e.prev,i=e,a=e.next;if(We(o,i,a)>=0)return!1;for(var s=o.x<i.x?o.x<a.x?o.x:a.x:i.x<a.x?i.x:a.x,u=o.y<i.y?o.y<a.y?o.y:a.y:i.y<a.y?i.y:a.y,c=o.x>i.x?o.x>a.x?o.x:a.x:i.x>a.x?i.x:a.x,l=o.y>i.y?o.y>a.y?o.y:a.y:i.y>a.y?i.y:a.y,h=qe(s,u,t,r,n),f=qe(c,l,t,r,n),d=e.prevZ,p=e.nextZ;d&&d.z>=h&&p&&p.z<=f;){if(d!==e.prev&&d!==e.next&&Ye(o.x,o.y,i.x,i.y,a.x,a.y,d.x,d.y)&&We(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,p!==e.prev&&p!==e.next&&Ye(o.x,o.y,i.x,i.y,a.x,a.y,p.x,p.y)&&We(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;d&&d.z>=h;){if(d!==e.prev&&d!==e.next&&Ye(o.x,o.y,i.x,i.y,a.x,a.y,d.x,d.y)&&We(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;p&&p.z<=f;){if(p!==e.prev&&p!==e.next&&Ye(o.x,o.y,i.x,i.y,a.x,a.y,p.x,p.y)&&We(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function Ue(e,t,r){var n=e;do{var o=n.prev,i=n.next.next;!Je(o,i)&&He(o,n,n.next,i)&&tt(o,i)&&tt(i,o)&&(t.push(o.i/r),t.push(n.i/r),t.push(i.i/r),ot(n),ot(n.next),n=e=i),n=n.next}while(n!==e);return Ne(n)}function ze(e,t,r,n,o,i){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Qe(a,s)){var u=rt(a,s);return a=Ne(a,a.next),u=Ne(u,u.next),Ce(a,t,r,n,o,i),void Ce(u,t,r,n,o,i)}s=s.next}a=a.next}while(a!==e)}function Xe(e,t){return e.x-t.x}function Re(e,t){if(t=function(e,t){var r,n=t,o=e.x,i=e.y,a=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var s=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=o&&s>a){if(a=s,s===o){if(i===n.y)return n;if(i===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(o===a)return r;var u,c=r,l=r.x,h=r.y,f=1/0;n=r;do{o>=n.x&&n.x>=l&&o!==n.x&&Ye(i<h?o:a,i,l,h,i<h?a:o,i,n.x,n.y)&&(u=Math.abs(i-n.y)/(o-n.x),tt(n,e)&&(u<f||u===f&&(n.x>r.x||n.x===r.x&&Ke(r,n)))&&(r=n,f=u)),n=n.next}while(n!==c);return r}(e,t),t){var r=rt(t,e);Ne(t,t.next),Ne(r,r.next)}}function Ke(e,t){return We(e.prev,e,t.prev)<0&&We(t.next,e,e.next)<0}function qe(e,t,r,n,o){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*o)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*o)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Ze(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function Ye(e,t,r,n,o,i,a,s){return(o-a)*(t-s)-(e-a)*(i-s)>=0&&(e-a)*(n-s)-(r-a)*(t-s)>=0&&(r-a)*(i-s)-(o-a)*(n-s)>=0}function Qe(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&He(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(tt(e,t)&&tt(t,e)&&function(e,t){var r=e,n=!1,o=(e.x+t.x)/2,i=(e.y+t.y)/2;do{r.y>i!=r.next.y>i&&r.next.y!==r.y&&o<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)&&(We(e.prev,e,t.prev)||We(e,t.prev,t))||Je(e,t)&&We(e.prev,e,e.next)>0&&We(t.prev,t,t.next)>0)}function We(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Je(e,t){return e.x===t.x&&e.y===t.y}function He(e,t,r,n){var o=et(We(e,t,r)),i=et(We(e,t,n)),a=et(We(r,n,e)),s=et(We(r,n,t));return o!==i&&a!==s||!(0!==o||!$e(e,r,t))||!(0!==i||!$e(e,n,t))||!(0!==a||!$e(r,e,n))||!(0!==s||!$e(r,t,n))}function $e(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function et(e){return e>0?1:e<0?-1:0}function tt(e,t){return We(e.prev,e,e.next)<0?We(e,t,e.next)>=0&&We(e,e.prev,t)>=0:We(e,t,e.prev)<0||We(e,e.next,t)<0}function rt(e,t){var r=new it(e.i,e.x,e.y),n=new it(t.i,t.x,t.y),o=e.next,i=t.prev;return e.next=t,t.prev=e,r.next=o,o.prev=r,n.next=r,r.prev=n,i.next=n,n.prev=i,n}function nt(e,t,r,n){var o=new it(e,t,r);return n?(o.next=n.next,o.prev=n,n.next.prev=o,n.next=o):(o.prev=o,o.next=o),o}function ot(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function it(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function at(e,t,r,n){for(var o=0,i=t,a=r-n;i<r;i+=n)o+=(e[a]-e[i])*(e[i+1]+e[a+1]),a=i;return o}function st(e){return function(e){if(Array.isArray(e))return ut(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return ut(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ut(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ut(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}ke.deviation=function(e,t,r,n){var o=t&&t.length,i=o?t[0]*r:e.length,a=Math.abs(at(e,0,i,r));if(o)for(var s=0,u=t.length;s<u;s++){var c=t[s]*r,l=s<u-1?t[s+1]*r:e.length;a-=Math.abs(at(e,c,l,r))}var h=0;for(s=0;s<n.length;s+=3){var f=n[s]*r,d=n[s+1]*r,p=n[s+2]*r;h+=Math.abs((e[f]-e[p])*(e[d+1]-e[f+1])-(e[f]-e[d])*(e[p+1]-e[f+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},ke.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,o=0;o<e.length;o++){for(var i=0;i<e[o].length;i++)for(var a=0;a<t;a++)r.vertices.push(e[o][i][a]);o>0&&(n+=e[o-1].length,r.holes.push(n))}return r};var ct=g.vec2(),lt=g.vec3(),ht=g.vec3(),ft=g.vec3();function dt(e){var t=e.data,r=e.xktModel,n=e.stats,o=void 0===n?{}:n,i=e.log;return new Promise((function(e,n){if(t)if("CityJSON"===t.type)if(r){var a=t.transform?function(e,t){for(var r=[],n=t.scale||g.vec3([1,1,1]),o=t.translate||g.vec3([0,0,0]),i=0,a=0;i<e.length;i++,a+=3){var s=e[i][0]*n[0]+o[0],u=e[i][1]*n[1]+o[1],c=e[i][2]*n[2]+o[2];r.push([s,u,c])}return r}(t.vertices,t.transform):t.vertices;o.sourceFormat=t.type||"",o.schemaVersion=t.version||"",o.title="",o.author="",o.created="",o.numMetaObjects=0,o.numPropertySets=0,o.numTriangles=0,o.numVertices=0,o.numObjects=0,o.numGeometries=0;var s=g.createUUID();r.createMetaObject({metaObjectId:s,metaObjectType:"Model",metaObjectName:"Model"}),o.numMetaObjects++;var u=g.createUUID();r.createMetaObject({metaObjectId:u,metaObjectType:"CityJSON",metaObjectName:"CityJSON",parentMetaObjectId:s}),o.numMetaObjects++;var c={data:t,vertices:a,xktModel:r,rootMetaObjectId:u,log:i||function(e){},nextId:0,stats:o};c.log("Using parser: parseCityJSONIntoXKTModel"),c.xktModel.schema=t.type+" "+t.version,c.log("Converting "+c.xktModel.schema),function(e){var t=e.data.CityObjects;for(var r in t)t.hasOwnProperty(r)&&pt(e,t[r],r)}(c),e()}else n("Argument expected: xktModel");else n("Invalid argument: data is not a CityJSON file");else n("Argument expected: data")}))}function pt(e,t,r){var n=e.xktModel,o=e.data,i=r,a=t.type,s=a+" : "+r,u=t.parents?t.parents[0]:e.rootMetaObjectId;if(n.createMetaObject({metaObjectId:i,metaObjectName:s,metaObjectType:a,parentMetaObjectId:u}),e.stats.numMetaObjects++,t.geometry&&t.geometry.length>0){for(var c=[],l=0,h=t.geometry.length;l<h;l++){var f=t.geometry[l],d=void 0,p=void 0,v=o.appearance;if(v){var m=v.materials;if(m){var y=f.material;if(y){var g=Object.keys(y);if(g.length>0){var x=y[g[0]];if(void 0!==x.value)d=m[x.value];else{var w=x.values;if(w){p=[];for(var b=0,M=w.length;b<M;b++){var I=m[w[l]];p.push(I)}}}}}}}p?vt(e,f,p,c):yt(e,f,d,c)}c.length>0&&(n.createEntity({entityId:r,meshIds:c}),e.stats.numObjects++)}}function vt(e,t,r,n){switch(t.type){case"MultiPoint":case"MultiLineString":case"GeometryInstance":break;case"MultiSurface":case"CompositeSurface":mt(e,r,t.boundaries,n);break;case"Solid":for(var o=t.boundaries,i=0;i<o.length;i++)mt(e,r,o[i],n);break;case"MultiSolid":case"CompositeSolid":for(var a=t.boundaries,s=0;s<a.length;s++)for(var u=0;u<a[s].length;u++)mt(e,r,a[s][u],n)}}function mt(e,t,r,n){for(var o=e.vertices,i=e.xktModel,a=0;a<r.length;a++){for(var s=r[a],u=t[a]||{diffuseColor:[.8,.8,.8],transparency:1},c=[],l=[],h=[],f={positions:[],indices:[]},d=0;d<s.length;d++){c.length>0&&l.push(c.length);var p=xt(e,s[d],h,f);c.push.apply(c,st(p))}if(3===c.length)f.indices.push(c[0]),f.indices.push(c[1]),f.indices.push(c[2]);else if(c.length>3){for(var v=[],m=0;m<c.length;m++)v.push({x:o[h[c[m]]][0],y:o[h[c[m]]][1],z:o[h[c[m]]][2]});for(var y=wt(v,g.vec3()),x=[],w=0;w<v.length;w++)bt(v[w],y,ct),x.unshift(ct[0]),x.unshift(ct[1]);for(var b=ke(x,l,2),M=0;M<b.length;M+=3)f.indices.unshift(c[b[M]]),f.indices.unshift(c[b[M+1]]),f.indices.unshift(c[b[M+2]])}var I=""+e.nextId++,T=""+e.nextId++;i.createGeometry({geometryId:I,primitiveType:"triangles",positions:f.positions,indices:f.indices}),i.createMesh({meshId:T,geometryId:I,color:u&&u.diffuseColor?u.diffuseColor:[.8,.8,.8],opacity:1}),n.push(T),e.stats.numGeometries++,e.stats.numVertices+=f.positions.length/3,e.stats.numTriangles+=f.indices.length/3}}function yt(e,t,r,n){var o=e.xktModel,i=[],a={positions:[],indices:[]};switch(t.type){case"MultiPoint":case"MultiLineString":case"GeometryInstance":break;case"MultiSurface":case"CompositeSurface":gt(e,t.boundaries,i,a);break;case"Solid":for(var s=t.boundaries,u=0;u<s.length;u++)gt(e,s[u],i,a);break;case"MultiSolid":case"CompositeSolid":for(var c=t.boundaries,l=0;l<c.length;l++)for(var h=0;h<c[l].length;h++)gt(e,c[l][h],i,a)}var f=""+e.nextId++,d=""+e.nextId++;o.createGeometry({geometryId:f,primitiveType:"triangles",positions:a.positions,indices:a.indices}),o.createMesh({meshId:d,geometryId:f,color:r&&r.diffuseColor?r.diffuseColor:[.8,.8,.8],opacity:1}),n.push(d),e.stats.numGeometries++,e.stats.numVertices+=a.positions.length/3,e.stats.numTriangles+=a.indices.length/3}function gt(e,t,r,n){for(var o=e.vertices,i=0;i<t.length;i++){for(var a=[],s=[],u=0;u<t[i].length;u++){a.length>0&&s.push(a.length);var c=xt(e,t[i][u],r,n);a.push.apply(a,st(c))}if(3===a.length)n.indices.push(a[0]),n.indices.push(a[1]),n.indices.push(a[2]);else if(a.length>3){for(var l=[],h=0;h<a.length;h++)l.push({x:o[r[a[h]]][0],y:o[r[a[h]]][1],z:o[r[a[h]]][2]});for(var f=wt(l,g.vec3()),d=[],p=0;p<l.length;p++)bt(l[p],f,ct),d.unshift(ct[0]),d.unshift(ct[1]);for(var v=ke(d,s,2),m=0;m<v.length;m+=3)n.indices.unshift(a[v[m]]),n.indices.unshift(a[v[m+1]]),n.indices.unshift(a[v[m+2]])}}}function xt(e,t,r,n){for(var o=e.vertices,i=[],a=0,s=t.length;a<s;a++){var u=t[a];if(r.includes(u)){var c=r.indexOf(u);i.push(c)}else n.positions.push(o[u][0]),n.positions.push(o[u][1]),n.positions.push(o[u][2]),i.push(r.length),r.push(u)}return i}function wt(e,t){for(var r=0;r<e.length;r++){var n=r+1;n===e.length&&(n=0),t[0]+=(e[r].y-e[n].y)*(e[r].z+e[n].z),t[1]+=(e[r].z-e[n].z)*(e[r].x+e[n].x),t[2]+=(e[r].x-e[n].x)*(e[r].y+e[n].y)}return g.normalizeVec3(t)}function bt(e,t,r){var n=lt,o=ht,i=ft;n[0]=e.x,n[1]=e.y,n[2]=e.z,o[0]=t.x,o[1]=t.y,o[2]=t.z,i[0]=1.1,i[1]=1.1,i[2]=1.1,g.lenVec3(g.subVec3(i,o))<.01&&(i[0]+=1,i[1]+=2,i[2]+=3);var a=g.dotVec3(i,o),s=g.mulVec3Scalar(o,a,g.vec3());i[0]-=s[0],i[1]-=s[1],i[2]-=s[2],g.normalizeVec3(i);var u=g.cross3Vec3(o,i,g.vec3()),c=g.dotVec3(n,i),l=g.dotVec3(n,u);r[0]=c,r[1]=l}var Mt=function(e){return"string"==typeof e||e instanceof String};const It=require("@loaders.gl/gltf");function Tt(e){var t=e.data,r=e.baseUri,n=e.xktModel,o=e.metaModelData,i=e.includeTextures,a=e.includeNormals,s=e.getAttachment,u=e.stats,c=void 0===u?{}:u,l=e.log;return new Promise((function(e,u){t?n?(c.sourceFormat="glTF",c.schemaVersion="2.0",c.title="",c.author="",c.created="",c.numTriangles=0,c.numVertices=0,c.numNormals=0,c.numUVs=0,c.numTextures=0,c.numObjects=0,c.numGeometries=0,(0,pe.parse)(t,It.GLTFLoader,{baseUri:r}).then((function(t){var r={gltfData:t,metaModelCorrections:o?At(o):null,getAttachment:s||function(){throw new Error("You must define getAttachment() method to convert glTF with external resources")},log:l||function(e){},error:function(e){console.error(e)},xktModel:n,includeNormals:a,includeTextures:i,geometryCreated:{},nextId:0,stats:c};r.log("Using parser: parseGLTFIntoXKTModel"),r.log("Parsing normals: ".concat(r.includeNormals?"enabled":"disabled")),r.log("Parsing textures: ".concat(r.includeTextures?"enabled":"disabled")),r.includeTextures&&function(e){var t=e.gltfData.textures;if(t)for(var r=0,n=t.length;r<n;r++)St(e,t[r]),e.stats.numTextures++}(r),function(e){var t=e.gltfData.materials;if(t)for(var r=0,n=t.length;r<n;r++){var o=t[r];o._textureSetId=e.includeTextures?Ot(e,o):null,o._attributes=Lt(0,o)}}(r),function(e){var t=e.gltfData,r=t.scene||t.scenes[0];r?function(e,t){var r=t.nodes;if(r){for(var n=0,o=r.length;n<o;n++)Pt(e,r[n]);for(var i=0,a=r.length;i<a;i++)jt(e,r[i],0,null)}}(e,r):e.error("glTF has no default scene")}(r),e()}),(function(e){u(e)}))):u("Argument expected: xktModel"):u("Argument expected: data")}))}function At(e){for(var t={},r={},n=e.metaObjects||[],o={},i=0,a=n.length;i<a;i++){var s=n[i];o[s.id]=s}for(var u=0,c=n.length;u<c;u++){var l=n[u];if(void 0!==l.parent&&null!==l.parent){var h=o[l.parent];if(l.type===h.type){for(var f=h;f.parent&&o[f.parent].type===f.type;)f=o[f.parent];(t[f.id]||(t[f.id]={numChildren:0,countChildren:0})).numChildren++,r[l.id]=f}}}return{metaObjectsMap:o,eachRootStats:t,eachChildRoot:r}}function St(e,t){if(t.source&&t.source.image){var r="texture-".concat(e.nextId++);e.xktModel.createTexture({textureId:r,imageData:t.source.image,width:t.source.image.width,height:t.source.image.height,flipY:!!t.flipY}),t._textureId=r}}function Ot(e,t){var r={};t.normalTexture&&(r.normalTextureId=t.normalTexture.texture._textureId),t.occlusionTexture&&(r.occlusionTextureId=t.occlusionTexture.texture._textureId),t.emissiveTexture&&(r.emissiveTextureId=t.emissiveTexture.texture._textureId);var n=t.pbrMetallicRoughness;if(t.pbrMetallicRoughness){var o=t.pbrMetallicRoughness,i=o.baseColorTexture||o.colorTexture;i&&(i.texture?r.colorTextureId=i.texture._textureId:r.colorTextureId=e.gltfData.textures[i.index]._textureId),n.metallicRoughnessTexture&&(r.metallicRoughnessTextureId=n.metallicRoughnessTexture.texture._textureId)}var a=t.extensions;if(a){var s=a.KHR_materials_pbrSpecularGlossiness;if(s){s.specularTexture;var u=s.specularColorTexture;null!=u&&(r.colorTextureId=e.gltfData.textures[u.index]._textureId)}}return void 0!==r.normalTextureId||void 0!==r.occlusionTextureId||void 0!==r.emissiveTextureId||void 0!==r.colorTextureId||void 0!==r.metallicRoughnessTextureId?(r.textureSetId="textureSet-".concat(e.nextId++,";"),e.xktModel.createTextureSet(r),e.stats.numTextureSets++,r.textureSetId):null}function Lt(e,t){var r=t.extensions,n={color:new Float32Array([1,1,1,1]),opacity:1,metallic:0,roughness:1};if(r){var o=r.KHR_materials_pbrSpecularGlossiness;if(o){var i=o.diffuseFactor;null!=i&&n.color.set(i)}var a=r.KHR_materials_common;if(a){var s=a.technique,u=a.values||{},c="BLINN"===s,l="PHONG"===s,h="LAMBERT"===s,f=u.diffuse;f&&(c||l||h)&&(Mt(f)||n.color.set(f));var d=u.transparency;null!=d&&(n.opacity=d);var p=u.transparent;null!=p&&(n.opacity=p)}}var v=t.pbrMetallicRoughness;if(v){var m=v.baseColorFactor;m&&(n.color[0]=m[0],n.color[1]=m[1],n.color[2]=m[2],n.opacity=m[3]);var y=v.metallicFactor;null!=y&&(n.metallic=y);var g=v.roughnessFactor;null!=g&&(n.roughness=g)}return n}function Pt(e,t){var r=t.mesh;if(r&&(r.instances=r.instances?r.instances+1:1),t.children)for(var n=t.children,o=0,i=n.length;o<i;o++){var a=n[o];a?Pt(e,a):e.error("Node not found: "+o)}}var Et=[];function jt(e,t,r,n){var o,i=e.xktModel;if(t.matrix&&(o=t.matrix,n=n?g.mulMat4(n,o,g.mat4()):o),t.translation&&(o=g.translationMat4v(t.translation),n=n?g.mulMat4(n,o,g.mat4()):o),t.rotation&&(o=g.quaternionToMat4(t.rotation),n=n?g.mulMat4(n,o,g.mat4()):o),t.scale&&(o=g.scalingMat4v(t.scale),n=n?g.mulMat4(n,o,g.mat4()):o),t.mesh){var a=t.mesh,s=a.primitives.length;if(s>0)for(var u=0;u<s;u++){var c=a.primitives[u];if(!c._xktGeometryId){var l="geometry-"+e.nextId++,h={geometryId:l};switch(c.mode){case 0:h.primitiveType="points";break;case 1:case 2:case 3:h.primitiveType="lines";break;default:h.primitiveType="triangles"}if(!c.attributes.POSITION)continue;h.positions=c.attributes.POSITION.value,e.stats.numVertices+=h.positions.length/3,e.includeNormals&&c.attributes.NORMAL&&(h.normals=c.attributes.NORMAL.value,e.stats.numNormals+=h.normals.length/3),c.attributes.COLOR_0&&(h.colorsCompressed=c.attributes.COLOR_0.value),e.includeTextures&&c.attributes.TEXCOORD_0&&(h.uvs=c.attributes.TEXCOORD_0.value,e.stats.numUVs+=h.uvs.length/2),c.indices&&(h.indices=c.indices.value,4===c.mode&&(e.stats.numTriangles+=h.indices.length/3)),i.createGeometry(h),c._xktGeometryId=l,e.stats.numGeometries++}var f=e.nextId++,d={meshId:f,geometryId:c._xktGeometryId,matrix:n?n.slice():g.identityMat4()},p=c.material;p?(d.textureSetId=p._textureSetId,d.color=p._attributes.color,d.opacity=p._attributes.opacity,d.metallic=p._attributes.metallic,d.roughness=p._attributes.roughness):(d.color=[1,1,1],d.opacity=1),i.createMesh(d),Et.push(f)}}if(t.children)for(var v=t.children,m=0,y=v.length;m<y;m++)jt(e,v[m],r+1,n);var x=t.name;if((null!=x||0===r)&&Et.length>0){var w=x||g.createUUID();for(i.entities[w]&&e.error("Two or more glTF nodes found with same 'name' attribute: '"+x+"'");!w||i.entities[w];)w="entity-"+e.nextId++;if(e.metaModelCorrections){var b=e.metaModelCorrections.eachChildRoot[w];if(b){var M=e.metaModelCorrections.eachRootStats[b.id];M.countChildren++,M.countChildren>=M.numChildren&&(i.createEntity({entityId:b.id,meshIds:Et}),e.stats.numObjects++,Et.length=0)}else e.metaModelCorrections.metaObjectsMap[w]&&(i.createEntity({entityId:w,meshIds:Et}),e.stats.numObjects++,Et.length=0)}else i.createEntity({entityId:w,meshIds:Et}),e.stats.numObjects++,Et.length=0}}var Gt="undefined"!=typeof atob?atob:function(e){return Buffer.from(e,"base64").toString("binary")},_t={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Dt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function kt(e){var t=e.data,r=e.xktModel,n=e.metaModelData,o=e.includeNormals,i=e.reuseGeometries,a=e.getAttachment,s=e.stats,u=void 0===s?{}:s,c=e.log;return c&&c("Using parser: parseGLTFJSONIntoXKTModel"),new Promise((function(e,s){if(t)if(r){u.sourceFormat="glTF",u.schemaVersion="2.0",u.title="",u.author="",u.created="",u.numTriangles=0,u.numVertices=0,u.numNormals=0,u.numObjects=0,u.numGeometries=0;var l={gltf:t,metaModelCorrections:n?Vt(n):null,getAttachment:a||function(){throw new Error("You must define getAttachment() method to convert glTF with external resources")},log:c||function(e){},xktModel:r,includeNormals:o,createXKTGeometryIds:{},nextMeshId:0,reuseGeometries:!1!==i,stats:u};l.log("Parsing normals: ".concat(l.includeNormals?"enabled":"disabled")),function(e){var t=e.gltf.buffers;return t?Promise.all(t.map((function(t){return function(e,t){return new Promise((function(r,n){if(t._arrayBuffer)return t._buffer=t._arrayBuffer,void r(t);var o=t.uri;o?function(e,t){return new Promise((function(r,n){var o=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(o){var i=!!o[2],a=o[3];a=decodeURIComponent(a),i&&(a=Gt(a));for(var s=new ArrayBuffer(a.length),u=new Uint8Array(s),c=0;c<a.length;c++)u[c]=a.charCodeAt(c);r(s)}else e.getAttachment(t).then((function(e){r(e)}),(function(e){n(e)}))}))}(e,o).then((function(e){t._buffer=e,r(e)}),(function(e){n(e)})):n("gltf/handleBuffer missing uri in "+JSON.stringify(t))}))}(e,t)}))):new Promise((function(e,t){e()}))}(l).then((function(){!function(e){var t=e.gltf.bufferViews;if(t)for(var r=0,n=t.length;r<n;r++)Nt(e,t[r])}(l),function(e){var t=e.gltf.buffers;if(t)for(var r=0,n=t.length;r<n;r++)t[r]._buffer=null}(l),function(e){var t=e.gltf.materials;if(t)for(var r=0,n=t.length;r<n;r++){var o=t[r],i=Ct(0,o);o._materialData=i}}(l),function(e){var t=e.gltf.scene||0,r=e.gltf.scenes[t];if(!r)throw new Error("glTF has no default scene");!function(e,t){var r=t.nodes;if(r)for(var n=0,o=r.length;n<o;n++){var i=e.gltf.nodes[r[n]];i&&Ft(e,i,0,null)}}(e,r)}(l),e()}),(function(e){s(e)}))}else s("Argument expected: xktModel");else s("Argument expected: data")}))}function Vt(e){for(var t={},r={},n=e.metaObjects||[],o={},i=0,a=n.length;i<a;i++){var s=n[i];o[s.id]=s}for(var u=0,c=n.length;u<c;u++){var l=n[u];if(void 0!==l.parent&&null!==l.parent){var h=o[l.parent];if(l.type===h.type){for(var f=h;f.parent&&o[f.parent].type===f.type;)f=o[f.parent];(t[f.id]||(t[f.id]={numChildren:0,countChildren:0})).numChildren++,r[l.id]=f}}}return{metaObjectsMap:o,eachRootStats:t,eachChildRoot:r}}function Nt(e,t){var r=e.gltf.buffers[t.buffer];t._typedArray=null;var n=t.byteLength||0,o=t.byteOffset||0;t._buffer=r._buffer.slice(o,o+n)}function Ct(e,t){var r={color:new Float32Array([1,1,1]),opacity:1,metallic:0,roughness:1},n=t.extensions;if(n){var o=n.KHR_materials_pbrSpecularGlossiness;if(o){var i=o.diffuseFactor;null!=i&&(r.color[0]=i[0],r.color[1]=i[1],r.color[2]=i[2])}var a=n.KHR_materials_common;if(a){var s=a.technique,u=a.values||{},c="BLINN"===s,l="PHONG"===s,h="LAMBERT"===s,f=u.diffuse;f&&(c||l||h)&&(Mt(f)||(r.color[0]=f[0],r.color[1]=f[1],r.color[2]=f[2]));var d=u.transparency;null!=d&&(r.opacity=d);var p=u.transparent;null!=p&&(r.opacity=p)}}var v=t.pbrMetallicRoughness;if(v){var m=v.baseColorFactor;m&&(r.color[0]=m[0],r.color[1]=m[1],r.color[2]=m[2],r.opacity=m[3]);var y=v.metallicFactor;null!=y&&(r.metallic=y);var g=v.roughnessFactor;null!=g&&(r.roughness=g)}return r}var Bt=[];function Ft(e,t,r,n){var o,i=e.gltf,a=e.xktModel;t.matrix&&(o=t.matrix,n=n?g.mulMat4(n,o,g.mat4()):o),t.translation&&(o=g.translationMat4v(t.translation),n=n?g.mulMat4(n,o,o):o),t.rotation&&(o=g.quaternionToMat4(t.rotation),n=n?g.mulMat4(n,o,o):o),t.scale&&(o=g.scalingMat4v(t.scale),n=n?g.mulMat4(n,o,o):o);var s=t.mesh;if(void 0!==s){var u=i.meshes[s];if(u){var c=u.primitives.length;if(c>0)for(var l=0;l<c;l++){var h=u.primitives[l],f=Ut(h),d=e.createXKTGeometryIds[f];if(!e.reuseGeometries||!d){d="geometry-"+e.nextMeshId++;var p={};zt(e,h,p);var v=p.colors,m=void 0;if(p.colors){m=[];for(var y=0,x=v.length;y<x;y+=4)m.push(v[y+0]),m.push(v[y+1]),m.push(v[y+2]),m.push(255)}a.createGeometry({geometryId:d,primitiveType:p.primitive,positions:p.positions,normals:e.includeNormals?p.normals:null,colorsCompressed:m,indices:p.indices}),e.stats.numGeometries++,e.stats.numVertices+=p.positions?p.positions.length/3:0,e.stats.numNormals+=e.includeNormals&&p.normals?p.normals.length/3:0,e.stats.numTriangles+=p.indices?p.indices.length/3:0,e.createXKTGeometryIds[f]=d}var w=h.material,b=null!=w?i.materials[w]:null,M=b?b._materialData.color:new Float32Array([1,1,1,1]),I=b?b._materialData.opacity:1,T=b?b._materialData.metallic:0,A=b?b._materialData.roughness:1,S="mesh-"+e.nextMeshId++;a.createMesh({meshId:S,geometryId:d,matrix:n?n.slice():g.identityMat4(),color:M,opacity:I,metallic:T,roughness:A}),Bt.push(S)}}}if(t.children)for(var O=t.children,L=0,P=O.length;L<P;L++){var E=O[L],j=i.nodes[E];j?Ft(e,j,r+1,n):console.warn("Node not found: "+L)}var G=t.name;if((null!=G||0===r)&&Bt.length>0){var _=G;if(e.metaModelCorrections){var D=e.metaModelCorrections.eachChildRoot[_];if(D){var k=e.metaModelCorrections.eachRootStats[D.id];k.countChildren++,k.countChildren>=k.numChildren&&(a.createEntity({entityId:D.id,meshIds:Bt}),e.stats.numObjects++,Bt=[])}else e.metaModelCorrections.metaObjectsMap[_]&&(a.createEntity({entityId:_,meshIds:Bt}),e.stats.numObjects++,Bt=[])}else a.createEntity({entityId:_,meshIds:Bt}),e.stats.numObjects++,Bt=[]}}function Ut(e){if(!e.attributes)return"empty";var t=e.mode,r=(e.material,e.indices),n=e.attributes.POSITION,o=e.attributes.NORMAL,i=e.attributes.COLOR_0,a=e.attributes.TEXCOORD_0;return[t,null!=r?r:"-",null!=n?n:"-",null!=o?o:"-",null!=i?i:"-",null!=a?a:"-"].join(";")}function zt(e,t,r){var n=t.attributes;if(n){switch(t.mode){case 0:r.primitive="points";break;case 1:case 2:case 3:r.primitive="lines";break;case 4:default:r.primitive="triangles";break;case 5:console.log("TRIANGLE_STRIP"),r.primitive="triangles";break;case 6:console.log("TRIANGLE_FAN"),r.primitive="triangles"}var o=e.gltf.accessors,i=t.indices;if(null!=i){var a=o[i];r.indices=Xt(e,a)}var s=n.POSITION;if(null!=s){var u=o[s];r.positions=Xt(e,u)}var c=n.NORMAL;if(null!=c){var l=o[c];r.normals=Xt(e,l)}var h=n.COLOR_0;if(null!=h){var f=o[h];r.colors=Xt(e,f)}}}function Xt(e,t){var r=e.gltf.bufferViews[t.bufferView],n=Dt[t.type],o=_t[t.componentType],i=o.BYTES_PER_ELEMENT*n;if(t.byteStride&&t.byteStride!==i)throw new Error("interleaved buffer!");return new o(r._buffer,t.byteOffset||0,t.count*n)}function Rt(e){var t=e.WebIFC,r=e.data,n=e.xktModel,o=e.autoNormals,i=void 0===o||o,a=e.includeTypes,s=e.excludeTypes,u=e.wasmPath,c=e.stats,l=void 0===c?{}:c,h=e.log;return h&&h("Using parser: parseIFCIntoXKTModel"),new Promise((function(e,o){if(r)if(n)if(u){var c=new t.IfcAPI;u&&c.SetWasmPath(u),c.Init().then((function(){var o=new Uint8Array(r),u=c.OpenModel(o);l.sourceFormat="IFC",l.schemaVersion="",l.title="",l.author="",l.created="",l.numMetaObjects=0,l.numPropertySets=0,l.numObjects=0,l.numGeometries=0,l.numTriangles=0,l.numVertices=0;var f={WebIFC:t,modelID:u,ifcAPI:c,xktModel:n,autoNormals:i,log:h||function(e){},nextId:0,stats:l};if(a){f.includeTypes={};for(var d=0,p=a.length;d<p;d++)f.includeTypes[a[d]]=!0}if(s){f.excludeTypes={};for(var v=0,m=s.length;v<m;v++)f.excludeTypes[s[v]]=!0}var y=f.ifcAPI.GetLineIDsWithType(u,t.IFCPROJECT).get(0);f.ifcAPI.GetLine(u,y),f.xktModel.schema="",f.xktModel.modelId=""+u,f.xktModel.projectId=""+y,function(e){var t=e.ifcAPI.GetLineIDsWithType(e.modelID,e.WebIFC.IFCPROJECT).get(0),r=e.ifcAPI.GetLine(e.modelID,t);Kt(e,r)}(f),function(e){for(var t=e.ifcAPI.LoadAllGeometry(e.modelID),r=0,n=t.size();r<n;r++){var o=t.get(r),i=o.expressID,a=o.geometries,s=[],u=e.ifcAPI.GetLine(e.modelID,i).GlobalId.value,c=u,l=e.xktModel.metaObjects[c];if(e.includeTypes&&(!l||!e.includeTypes[l.metaObjectType]))return;if(e.excludeTypes&&(!l||e.excludeTypes[l.metaObjectType]))return void console.log("excluding: "+c);for(var h=0,f=a.size();h<f;h++){var d=a.get(h),p=""+d.geometryExpressID;if(!e.xktModel.geometries[p]){for(var v=e.ifcAPI.GetGeometry(e.modelID,d.geometryExpressID),m=e.ifcAPI.GetVertexArray(v.GetVertexData(),v.GetVertexDataSize()),y=e.ifcAPI.GetIndexArray(v.GetIndexData(),v.GetIndexDataSize()),g=[],x=[],w=0,b=m.length/6;w<b;w++)g.push(m[6*w+0]),g.push(m[6*w+1]),g.push(m[6*w+2]);if(!e.autoNormals)for(var M=0,I=m.length/6;M<I;M++)x.push(m[6*M+3]),x.push(m[6*M+4]),x.push(m[6*M+5]);e.xktModel.createGeometry({geometryId:p,primitiveType:"triangles",positions:g,normals:e.autoNormals?null:x,indices:y}),e.stats.numGeometries++,e.stats.numVertices+=g.length/3,e.stats.numTriangles+=y.length/3}var T="mesh"+e.nextId++;e.xktModel.createMesh({meshId:T,geometryId:p,matrix:new Float32Array(d.flatTransformation),color:[d.color.x,d.color.y,d.color.z],opacity:d.color.w}),s.push(T)}e.xktModel.createEntity({entityId:u,meshIds:s}),e.stats.numObjects++}}(f),function(e){for(var t=e.ifcAPI.GetLineIDsWithType(e.modelID,e.WebIFC.IFCRELDEFINESBYPROPERTIES),r=0;r<t.size();r++){var n=t.get(r),o=e.ifcAPI.GetLine(e.modelID,n,!0);if(o){var i=o.RelatingPropertyDefinition;if(!i)continue;var a=i.GlobalId.value,s=o.RelatedObjects;if(s)for(var u=0,c=s.length;u<c;u++){var l=s[u].GlobalId.value,h=e.xktModel.metaObjects[l];h&&(h.propertySetIds||(h.propertySetIds=[]),h.propertySetIds.push(a))}var f=i.HasProperties;if(f&&f.length>0){for(var d=i.Name.value,p=[],v=0,m=f.length;v<m;v++){var y=f[v],g=y.Name,x=y.NominalValue;if(g&&x){var w={name:g.value,type:x.type,value:x.value,valueType:x.valueType};y.Description?w.description=y.Description.value:x.description&&(w.description=x.description),p.push(w)}}e.xktModel.createPropertySet({propertySetId:a,propertySetType:"Default",propertySetName:d,properties:p}),e.stats.numPropertySets++}}}}(f),e()})).catch((function(e){o(e)}))}else o("Argument expected: wasmPath");else o("Argument expected: xktModel");else o("Argument expected: data")}))}function Kt(e,t,r){var n=t.__proto__.constructor.name;if((!e.includeTypes||e.includeTypes[n])&&(!e.excludeTypes||!e.excludeTypes[n])){!function(e,t,r){var n=t.GlobalId.value,o=t.__proto__.constructor.name,i=t.Name&&""!==t.Name.value?t.Name.value:o;e.xktModel.createMetaObject({metaObjectId:n,propertySetIds:null,metaObjectType:o,metaObjectName:i,parentMetaObjectId:r}),e.stats.numMetaObjects++}(e,t,r);var o=t.GlobalId.value;qt(e,t.expressID,"RelatingObject","RelatedObjects",e.WebIFC.IFCRELAGGREGATES,o),qt(e,t.expressID,"RelatingStructure","RelatedElements",e.WebIFC.IFCRELCONTAINEDINSPATIALSTRUCTURE,o)}}function qt(e,t,r,n,o,i){for(var a=e.ifcAPI.GetLineIDsWithType(e.modelID,o),s=0;s<a.size();s++){var u=a.get(s),c=e.ifcAPI.GetLine(e.modelID,u),l=c[r];if(Array.isArray(l)?l.map((function(e){return e.value})).includes(t):l.value===t){var h=c[n];if(Array.isArray(h))h.forEach((function(t){var r=e.ifcAPI.GetLine(e.modelID,t.value);Kt(e,r,i)}));else{var f=e.ifcAPI.GetLine(e.modelID,h.value);Kt(e,f,i)}}}}const Zt=require("@loaders.gl/las");function Yt(e){var t=e.data,r=e.xktModel,n=e.rotateX,o=void 0!==n&&n,i=e.colorDepth,a=void 0===i?8:i,s=e.skip,u=void 0===s?1:s,c=e.stats,l=e.log,h=void 0===l?function(){}:l;return h&&h("Using parser: parseLASIntoXKTModel"),new Promise((function(e,n){t?r?(h&&(h("Converting LAZ/LAS"),o&&h("Rotating model 90 degrees about X-axis")),(0,pe.parse)(t,Zt.LASLoader,{las:{colorDepth:a,skip:u}}).then((function(t){var n=t.attributes,i=t.loaderData,a=void 0!==i.pointsFormatId?i.pointsFormatId:-1;if(n.POSITION){var s,u;switch(a){case 0:if(!n.intensity)return void h("No intensities found in file (expected for LAS point format 0)");s=Qt(n.POSITION,o),u=Jt(n.intensity);break;case 1:if(!n.intensity)return void h("No intensities found in file (expected for LAS point format 1)");s=Qt(n.POSITION,o),u=Jt(n.intensity);break;case 2:if(!n.intensity)return void h("No intensities found in file (expected for LAS point format 2)");s=Qt(n.POSITION,o),u=Wt(n.COLOR_0,n.intensity);break;case 3:if(!n.intensity)return void h("No intensities found in file (expected for LAS point format 3)");s=Qt(n.POSITION,o),u=Wt(n.COLOR_0,n.intensity)}r.createGeometry({geometryId:"pointsGeometry",primitiveType:"points",positions:s,colorsCompressed:u}),r.createMesh({meshId:"pointsMesh",geometryId:"pointsGeometry"});var l=g.createUUID();r.createEntity({entityId:l,meshIds:["pointsMesh"]});var f=g.createUUID();r.createMetaObject({metaObjectId:f,metaObjectType:"Model",metaObjectName:"Model"}),r.createMetaObject({metaObjectId:l,metaObjectType:"PointCloud",metaObjectName:"PointCloud (LAZ)",parentMetaObjectId:f}),c&&(c.sourceFormat="LAS",c.schemaVersion="",c.title="",c.author="",c.created="",c.numMetaObjects=2,c.numPropertySets=0,c.numObjects=1,c.numGeometries=1,c.numVertices=s.length/3),e()}else h("No positions found in file (expected for all LAS point formats)")}),(function(e){n(e)}))):n("Argument expected: xktModel"):n("Argument expected: data")}))}function Qt(e,t){var r=e.value;if(t&&r)for(var n=0,o=r.length;n<o;n+=3){var i=r[n+1];r[n+1]=r[n+2],r[n+2]=i}return r}function Wt(e,t){for(var r=e.value,n=e.size,o=t.value,i=4*o.length,a=new Uint8Array(i),s=0,u=0,c=0,l=o.length;s<l;s++,c+=n,u+=4)a[u+0]=r[c+0],a[u+1]=r[c+1],a[u+2]=r[c+2],a[u+3]=Math.round(o[s]/65536*255);return a}function Jt(e){for(var t=e.intensity,r=4*t.length,n=new Uint8Array(r),o=0,i=0,a=t.length;o<a;o++,i+=4)n[i+0]=0,n[i+1]=0,n[i+2]=0,n[i+3]=Math.round(t[o]/65536*255);return n}function Ht(e){var t=e.metaModelData,r=e.xktModel,n=e.includeTypes,o=e.excludeTypes,i=e.log;return i&&i("Using parser: parseMetaModelIntoXKTModel"),new Promise((function(e,a){var s,u,c=t.metaObjects||[],l=t.propertySets||[];r.modelId=t.revisionId||"",r.projectId=t.projectId||"",r.revisionId=t.revisionId||"",r.author=t.author||"",r.createdAt=t.createdAt||"",r.creatingApplication=t.creatingApplication||"",r.schema=t.schema||"";for(var h=0,f=l.length;h<f;h++){var d=l[h];r.createPropertySet({propertySetId:d.id,propertySetName:d.name,propertySetType:d.type,properties:d.properties})}if(n){s={};for(var p=0,v=n.length;p<v;p++)s[n[p]]=!0}if(o){u={};for(var m=0,y=o.length;m<y;m++)u[o[m]]=!0}for(var g={},x=0,w=c.length;x<w;x++){var b=c[x];g[b.id]=b}for(var M=0,I=0,T=c.length;I<T;I++){var A=c[I],S=A.type;if((!u||!u[S])&&(!s||s[S])){if(void 0!==A.parent&&null!==A.parent){var O=g[A.parent];if(A.type===O.type)continue}var L=[];if(A.propertySetIds)for(var P=0,E=A.propertySetIds.length;P<E;P++){var j=A.propertySetIds[P];null!=j&&""!==j&&L.push(j)}void 0!==A.propertySetId&&null!==A.propertySetId&&""!==A.propertySetId&&L.push(A.propertySetId),r.createMetaObject({metaObjectId:A.id,metaObjectType:A.type,metaObjectName:A.name,parentMetaObjectId:A.parent,propertySetIds:L.length>0?L:null}),M++}}i&&i("Converted meta objects: "+M),e()}))}function $t(e){var t=e.data,r=e.xktModel,n=e.littleEndian,o=void 0===n||n,i=e.stats,a=e.log;return a&&a("Using parser: parsePCDIntoXKTModel"),new Promise((function(e,n){var s=function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",r=0,n=e.length;r<n;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch(e){return t}}(new Uint8Array(t)),u=function(e){var t={},r=e.search(/[\r\n]DATA\s(\S*)\s/i),n=/[\r\n]DATA\s(\S*)\s/i.exec(e.substr(r-1));if(t.data=n[1],t.headerLen=n[0].length+r,t.str=e.substr(0,t.headerLen),t.str=t.str.replace(/\#.*/gi,""),t.version=/VERSION (.*)/i.exec(t.str),t.fields=/FIELDS (.*)/i.exec(t.str),t.size=/SIZE (.*)/i.exec(t.str),t.type=/TYPE (.*)/i.exec(t.str),t.count=/COUNT (.*)/i.exec(t.str),t.width=/WIDTH (.*)/i.exec(t.str),t.height=/HEIGHT (.*)/i.exec(t.str),t.viewpoint=/VIEWPOINT (.*)/i.exec(t.str),t.points=/POINTS (.*)/i.exec(t.str),null!==t.version&&(t.version=parseFloat(t.version[1])),null!==t.fields&&(t.fields=t.fields[1].split(" ")),null!==t.type&&(t.type=t.type[1].split(" ")),null!==t.width&&(t.width=parseInt(t.width[1])),null!==t.height&&(t.height=parseInt(t.height[1])),null!==t.viewpoint&&(t.viewpoint=t.viewpoint[1]),null!==t.points&&(t.points=parseInt(t.points[1],10)),null===t.points&&(t.points=t.width*t.height),null!==t.size&&(t.size=t.size[1].split(" ").map((function(e){return parseInt(e,10)}))),null!==t.count)t.count=t.count[1].split(" ").map((function(e){return parseInt(e,10)}));else{t.count=[];for(var o=0,i=t.fields.length;o<i;o++)t.count.push(1)}t.offset={};for(var a=0,s=0,u=t.fields.length;s<u;s++)"ascii"===t.data?t.offset[t.fields[s]]=s:(t.offset[t.fields[s]]=a,a+=t.size[s]*t.count[s]);return t.rowSize=a,t}(s),c=[],l=[];if("ascii"===u.data)for(var h=u.offset,f=s.substr(u.headerLen).split("\n"),d=0,p=f.length;d<p;d++)if(""!==f[d]){var v=f[d].split(" ");if(void 0!==h.x&&(c.push(parseFloat(v[h.x])),c.push(parseFloat(v[h.y])),c.push(parseFloat(v[h.z]))),void 0!==h.rgb){var m=parseFloat(v[h.rgb]),y=m>>16&255,g=m>>8&255,x=m>>0&255;l.push(y,g,x,255)}else l.push(255),l.push(255),l.push(255)}if("binary_compressed"===u.data)for(var w=new Uint32Array(t.slice(u.headerLen,u.headerLen+8)),b=w[0],M=w[1],I=function(e,t){var r,n,o,i=e.length,a=new Uint8Array(t),s=0,u=0;do{if((r=e[s++])<32){if(u+ ++r>t)throw new Error("Output buffer is not large enough");if(s+r>i)throw new Error("Invalid compressed data");do{a[u++]=e[s++]}while(--r)}else{if(n=r>>5,o=u-((31&r)<<8)-1,s>=i)throw new Error("Invalid compressed data");if(7===n&&(n+=e[s++],s>=i))throw new Error("Invalid compressed data");if(o-=e[s++],u+n+2>t)throw new Error("Output buffer is not large enough");if(o<0)throw new Error("Invalid compressed data");if(o>=u)throw new Error("Invalid compressed data");do{a[u++]=a[o++]}while(2+--n)}}while(s<i);return a}(new Uint8Array(t,u.headerLen+8,b),M),T=new DataView(I.buffer),A=u.offset,S=0;S<u.points;S++)void 0!==A.x&&(c.push(T.getFloat32(u.points*A.x+u.size[0]*S,o)),c.push(T.getFloat32(u.points*A.y+u.size[1]*S,o)),c.push(T.getFloat32(u.points*A.z+u.size[2]*S,o))),void 0!==A.rgb?(l.push(T.getUint8(u.points*A.rgb+u.size[3]*S+0)),l.push(T.getUint8(u.points*A.rgb+u.size[3]*S+1)),l.push(T.getUint8(u.points*A.rgb+u.size[3]*S+2))):(l.push(1),l.push(1),l.push(1));if("binary"===u.data)for(var O=new DataView(t,u.headerLen),L=u.offset,P=0,E=0;P<u.points;P++,E+=u.rowSize)void 0!==L.x&&(c.push(O.getFloat32(E+L.x,o)),c.push(O.getFloat32(E+L.y,o)),c.push(O.getFloat32(E+L.z,o))),void 0!==L.rgb?(l.push(O.getUint8(E+L.rgb+2)),l.push(O.getUint8(E+L.rgb+1)),l.push(O.getUint8(E+L.rgb+0))):(l.push(255),l.push(255),l.push(255));r.createGeometry({geometryId:"pointsGeometry",primitiveType:"points",positions:c,colors:l&&l.length>0?l:null}),r.createMesh({meshId:"pointsMesh",geometryId:"pointsGeometry"}),r.createEntity({entityId:"geometries",meshIds:["pointsMesh"]}),a&&(a("Converted drawable objects: 1"),a("Converted geometries: 1"),a("Converted vertices: "+c.length/3)),i&&(i.sourceFormat="PCD",i.schemaVersion="",i.title="",i.author="",i.created="",i.numObjects=1,i.numGeometries=1,i.numVertices=c.length/3),e()}))}const er=require("@loaders.gl/ply");function tr(e){return tr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tr(e)}function rr(){rr=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var o=t&&t.prototype instanceof h?t:h,i=Object.create(o.prototype),a=new I(n||[]);return i._invoke=function(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=c(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(e,r,a),i}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var l={};function h(){}function f(){}function d(){}var p={};s(p,o,(function(){return this}));var v=Object.getPrototypeOf,m=v&&v(v(T([])));m&&m!==t&&r.call(m,o)&&(p=m);var y=d.prototype=h.prototype=Object.create(p);function g(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(o,i,a,s){var u=c(e[o],e,i);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==tr(h)&&r.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(h).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,s)}))}s(u.arg)}var o;this._invoke=function(e,r){function i(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(i,i):i()}}function w(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function T(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:A}}function A(){return{value:void 0,done:!0}}return f.prototype=d,s(y,"constructor",d),s(d,"constructor",f),f.displayName=s(d,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,s(e,a,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},g(x.prototype),s(x.prototype,i,(function(){return this})),e.AsyncIterator=x,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new x(u(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},g(y),s(y,a,"Generator"),s(y,o,(function(){return this})),s(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=T,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(M),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),M(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;M(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:T(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}function nr(e,t,r,n,o,i,a){try{var s=e[i](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function or(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){nr(i,n,o,a,s,"next",e)}function s(e){nr(i,n,o,a,s,"throw",e)}a(void 0)}))}}function ir(e){return ar.apply(this,arguments)}function ar(){return(ar=or(rr().mark((function e(t){var r,n,o,i,a,s,u,c,l,h,f;return rr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.data,n=t.xktModel,o=t.stats,(i=t.log)&&i("Using parser: parsePLYIntoXKTModel"),r){e.next=4;break}throw"Argument expected: data";case 4:if(n){e.next=6;break}throw"Argument expected: xktModel";case 6:return e.prev=6,e.next=9,(0,pe.parse)(r,er.PLYLoader);case 9:a=e.sent,e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(6),i&&i("Error: "+e.t0),e.abrupt("return");case 16:if(s=a.attributes,u=!!s.COLOR_0){for(c=u?s.COLOR_0.value:null,l=[],h=0,f=c.length;h<f;h+=4)l.push(c[h]),l.push(c[h+1]),l.push(c[h+2]);n.createGeometry({geometryId:"plyGeometry",primitiveType:"triangles",positions:s.POSITION.value,indices:a.indices?a.indices.value:[],colorsCompressed:l})}else n.createGeometry({geometryId:"plyGeometry",primitiveType:"triangles",positions:s.POSITION.value,indices:a.indices?a.indices.value:[]});n.createMesh({meshId:"plyMesh",geometryId:"plyGeometry",color:u?null:[1,1,1]}),n.createEntity({entityId:"ply",meshIds:["plyMesh"]}),o&&(o.sourceFormat="PLY",o.schemaVersion="",o.title="",o.author="",o.created="",o.numMetaObjects=2,o.numPropertySets=0,o.numObjects=1,o.numGeometries=1,o.numVertices=s.POSITION.value.length/3);case 22:case"end":return e.stop()}}),e,null,[[6,12]])})))).apply(this,arguments)}function sr(e){return sr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},sr(e)}function ur(){ur=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var o=t&&t.prototype instanceof h?t:h,i=Object.create(o.prototype),a=new I(n||[]);return i._invoke=function(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=c(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(e,r,a),i}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var l={};function h(){}function f(){}function d(){}var p={};s(p,o,(function(){return this}));var v=Object.getPrototypeOf,m=v&&v(v(T([])));m&&m!==t&&r.call(m,o)&&(p=m);var y=d.prototype=h.prototype=Object.create(p);function g(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(o,i,a,s){var u=c(e[o],e,i);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==sr(h)&&r.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(h).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,s)}))}s(u.arg)}var o;this._invoke=function(e,r){function i(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(i,i):i()}}function w(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function T(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:A}}function A(){return{value:void 0,done:!0}}return f.prototype=d,s(y,"constructor",d),s(d,"constructor",f),f.displayName=s(d,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,s(e,a,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},g(x.prototype),s(x.prototype,i,(function(){return this})),e.AsyncIterator=x,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new x(u(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},g(y),s(y,a,"Generator"),s(y,o,(function(){return this})),s(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=T,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(M),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),M(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;M(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:T(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}function cr(e,t,r,n,o,i,a){try{var s=e[i](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function lr(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){cr(i,n,o,a,s,"next",e)}function s(e){cr(i,n,o,a,s,"throw",e)}a(void 0)}))}}function hr(e){return fr.apply(this,arguments)}function fr(){return(fr=lr(ur().mark((function e(t){var r,n,o,i,a,s,u,c;return ur().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.data,n=t.splitMeshes,o=t.autoNormals,i=t.smoothNormals,a=t.smoothNormalsAngleThreshold,s=t.xktModel,u=t.stats,(c=t.log)&&c("Using parser: parseSTLIntoXKTModel"),e.abrupt("return",new Promise((function(e,t){if(r)if(s){var l=g.createUUID(),h=s.createMetaObject({metaObjectId:l,metaObjectType:"Model",metaObjectName:"Model"}),f={data:r,splitMeshes:n,autoNormals:o,smoothNormals:i,smoothNormalsAngleThreshold:a,xktModel:s,rootMetaObject:h,nextId:0,log:c||function(e){},stats:{numObjects:0,numGeometries:0,numTriangles:0,numVertices:0}},d=xr(r);dr(d)?pr(f,d):vr(f,gr(r)),u&&(u.sourceFormat="STL",u.schemaVersion="",u.title="",u.author="",u.created="",u.numMetaObjects=2,u.numPropertySets=0,u.numObjects=1,u.numGeometries=1,u.numTriangles=f.stats.numTriangles,u.numVertices=f.stats.numVertices),e()}else t("Argument expected: xktModel");else t("Argument expected: data")})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function dr(e){var t=new DataView(e);if(84+50*t.getUint32(80,!0)===t.byteLength)return!0;for(var r=[115,111,108,105,100],n=0;n<5;n++)if(r[n]!==t.getUint8(n,!1))return!0;return!1}function pr(e,t){for(var r,n,o,i,a,s,u,c=new DataView(t),l=c.getUint32(80,!0),h=!1,f=null,d=null,p=null,v=!1,m=0;m<70;m++)1129270351===c.getUint32(m,!1)&&82===c.getUint8(m+4)&&61===c.getUint8(m+5)&&(h=!0,i=[],a=c.getUint8(m+6)/255,s=c.getUint8(m+7)/255,u=c.getUint8(m+8)/255,c.getUint8(m+9));for(var y=[],g=[],x=e.splitMeshes,w=0;w<l;w++){var b=84+50*w,M=c.getFloat32(b,!0),I=c.getFloat32(b+4,!0),T=c.getFloat32(b+8,!0);if(h){var A=c.getUint16(b+48,!0);0==(32768&A)?(r=(31&A)/31,n=(A>>5&31)/31,o=(A>>10&31)/31):(r=a,n=s,o=u),(x&&r!==f||n!==d||o!==p)&&(null!==f&&(v=!0),f=r,d=n,p=o)}for(var S=1;S<=3;S++){var O=b+12*S;y.push(c.getFloat32(O,!0)),y.push(c.getFloat32(O+4,!0)),y.push(c.getFloat32(O+8,!0)),e.autoNormals||g.push(M,I,T),h&&i.push(r,n,o,1)}x&&v&&(yr(e,y,g,i),y=[],g=[],i=i?[]:null,v=!1)}y.length>0&&yr(e,y,g,i)}function vr(e,t){for(var r,n,o,i,a,s,u,c=/facet([\s\S]*?)endfacet/g,l=0,h=/[\s]+([+-]?(?:\d+.\d+|\d+.|\d+|.\d+)(?:[eE][+-]?\d+)?)/.source,f=new RegExp("vertex"+h+h+h,"g"),d=new RegExp("normal"+h+h+h,"g"),p=[],v=[];null!==(i=c.exec(t));){for(a=0,s=0,u=i[0];null!==(i=d.exec(u));)r=parseFloat(i[1]),n=parseFloat(i[2]),o=parseFloat(i[3]),s++;for(;null!==(i=f.exec(u));)p.push(parseFloat(i[1]),parseFloat(i[2]),parseFloat(i[3])),v.push(r,n,o),a++;if(1!==s)return e.log("Error in normal of face "+l),-1;if(3!==a)return e.log("Error in positions of face "+l),-1;l++}yr(e,p,v,null)}var mr=0;function yr(e,t,r,n){for(var o=new Int32Array(t.length/3),i=0,a=o.length;i<a;i++)o[i]=i;r=r&&r.length>0?r:null,n=n&&n.length>0?n:null,!e.autoNormals&&e.smoothNormals&&function(e,t){var r,n,o,i,a,s,u,c,l,h,f,d=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).smoothNormalsAngleThreshold||20,p={},v=[],m={},y=4,x=Math.pow(10,y);for(u=0,l=e.length;u<l;u+=3){s=u/3,n=e[u],o=e[u+1],i=e[u+2],void 0===p[a="".concat(Math.round(n*x),"_").concat(Math.round(o*x),"_").concat(Math.round(i*x))]?p[a]=[s]:p[a].push(s);var w=g.normalizeVec3([t[u],t[u+1],t[u+2]]);v[s]=w,r=g.vec4([w[0],w[1],w[2],1]),m[s]=r}for(a in p)if(p.hasOwnProperty(a)){var b=p[a],M=b.length;for(u=0;u<M;u++){var I=b[u];for(r=m[I],c=0;c<M;c++)if(u!==c){var T=b[c];h=v[I],f=v[T],Math.abs(g.angleVec3(h,f)/g.DEGTORAD)<d&&(r[0]+=f[0],r[1]+=f[1],r[2]+=f[2],r[3]+=1)}}}for(u=0,l=t.length;u<l;u+=3)r=m[u/3],t[u+0]=r[0]/r[3],t[u+1]=r[1]/r[3],t[u+2]=r[2]/r[3]}(t,r,{smoothNormalsAngleThreshold:e.smoothNormalsAngleThreshold});var s=""+mr++,u=""+mr++,c=""+mr++;e.xktModel.createGeometry({geometryId:s,primitiveType:"triangles",positions:t,normals:e.autoNormals?null:r,colors:n,indices:o}),e.xktModel.createMesh({meshId:u,geometryId:s,color:n?null:[1,1,1],metallic:.9,roughness:.1}),e.xktModel.createEntity({entityId:c,meshIds:[u]}),e.xktModel.createMetaObject({metaObjectId:c,metaObjectType:"Default",metaObjectName:"STL Mesh",parentMetaObjectId:e.rootMetaObject.metaObjectId}),e.stats.numGeometries++,e.stats.numObjects++,e.stats.numVertices+=t.length/3,e.stats.numTriangles+=o.length/3}function gr(e){return"string"!=typeof e?function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",r=0,n=e.length;r<n;r++)t+=String.fromCharCode(e[r]);return decodeURIComponent(escape(t))}(new Uint8Array(e)):e}function xr(e){if("string"==typeof e){for(var t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer||t}return e}function wr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.xSize||1;t<0&&(console.error("negative xSize not allowed - will invert"),t*=-1);var r=e.ySize||1;r<0&&(console.error("negative ySize not allowed - will invert"),r*=-1);var n=e.zSize||1;n<0&&(console.error("negative zSize not allowed - will invert"),n*=-1);var o=e.center,i=o?o[0]:0,a=o?o[1]:0,s=o?o[2]:0,u=-t+i,c=-r+a,l=-n+s,h=t+i,f=r+a,d=n+s;return{primitiveType:"triangles",positions:[h,f,d,u,f,d,u,c,d,h,c,d,h,f,d,h,c,d,h,c,l,h,f,l,h,f,d,h,f,l,u,f,l,u,f,d,u,f,d,u,f,l,u,c,l,u,c,d,u,c,l,h,c,l,h,c,d,u,c,d,h,c,l,u,c,l,u,f,l,h,f,l],normals:[0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],uv:[1,0,0,0,0,1,1,1,0,0,0,1,1,1,1,0,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}}function br(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.xSize||1;t<0&&(console.error("negative xSize not allowed - will invert"),t*=-1);var r=e.ySize||1;r<0&&(console.error("negative ySize not allowed - will invert"),r*=-1);var n=e.zSize||1;n<0&&(console.error("negative zSize not allowed - will invert"),n*=-1);var o=e.center,i=o?o[0]:0,a=o?o[1]:0,s=o?o[2]:0,u=-t+i,c=-r+a,l=-n+s,h=t+i,f=r+a,d=n+s;return{primitiveType:"lines",positions:[u,c,l,u,c,d,u,f,l,u,f,d,h,c,l,h,c,d,h,f,l,h,f,d],indices:[0,1,1,3,3,2,2,0,4,5,5,7,7,6,6,4,0,4,1,5,2,6,3,7]}}function Mr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.radiusTop||1;t<0&&(console.error("negative radiusTop not allowed - will invert"),t*=-1);var r=e.radiusBottom||1;r<0&&(console.error("negative radiusBottom not allowed - will invert"),r*=-1);var n=e.height||1;n<0&&(console.error("negative height not allowed - will invert"),n*=-1);var o=e.radialSegments||32;o<0&&(console.error("negative radialSegments not allowed - will invert"),o*=-1),o<3&&(o=3);var i=e.heightSegments||1;i<0&&(console.error("negative heightSegments not allowed - will invert"),i*=-1),i<1&&(i=1);var a,s,u,c,l,h,f,d,p,v,m,y=!!e.openEnded,g=e.center,x=g?g[0]:0,w=g?g[1]:0,b=g?g[2]:0,M=n/2,I=n/i,T=2*Math.PI/o,A=1/o,S=(t-r)/i,O=[],L=[],P=[],E=[],j=(90-180*Math.atan(n/(r-t))/Math.PI)/90;for(a=0;a<=i;a++)for(l=t-a*S,h=M-a*I,s=0;s<=o;s++)u=Math.sin(s*T),c=Math.cos(s*T),L.push(l*u),L.push(j),L.push(l*c),P.push(s*A),P.push(1*a/i),O.push(l*u+x),O.push(h+w),O.push(l*c+b);for(a=0;a<i;a++)for(s=0;s<=o;s++)d=(f=a*(o+1)+s)+o,E.push(f),E.push(d),E.push(d+1),E.push(f),E.push(d+1),E.push(f+1);if(!y&&t>0){for(p=O.length/3,L.push(0),L.push(1),L.push(0),P.push(.5),P.push(.5),O.push(0+x),O.push(M+w),O.push(0+b),s=0;s<=o;s++)u=Math.sin(s*T),c=Math.cos(s*T),v=.5*Math.sin(s*T)+.5,m=.5*Math.cos(s*T)+.5,L.push(t*u),L.push(1),L.push(t*c),P.push(v),P.push(m),O.push(t*u+x),O.push(M+w),O.push(t*c+b);for(s=0;s<o;s++)g=p,f=p+1+s,E.push(f),E.push(f+1),E.push(g)}if(!y&&r>0){for(p=O.length/3,L.push(0),L.push(-1),L.push(0),P.push(.5),P.push(.5),O.push(0+x),O.push(0-M+w),O.push(0+b),s=0;s<=o;s++)u=Math.sin(s*T),c=Math.cos(s*T),v=.5*Math.sin(s*T)+.5,m=.5*Math.cos(s*T)+.5,L.push(r*u),L.push(-1),L.push(r*c),P.push(v),P.push(m),O.push(r*u+x),O.push(0-M+w),O.push(r*c+b);for(s=0;s<o;s++)g=p,f=p+1+s,E.push(g),E.push(f+1),E.push(f)}return{primitiveType:"triangles",positions:O,normals:L,uv:P,uvs:P,indices:E}}function Ir(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.size||1;t<0&&(console.error("negative size not allowed - will invert"),t*=-1);var r=e.divisions||1;r<0&&(console.error("negative divisions not allowed - will invert"),r*=-1),r<1&&(r=1);for(var n=(t=t||10)/(r=r||10),o=t/2,i=[],a=[],s=0,u=0,c=-o;u<=r;u++,c+=n)i.push(-o),i.push(0),i.push(c),i.push(o),i.push(0),i.push(c),i.push(c),i.push(0),i.push(-o),i.push(c),i.push(0),i.push(o),a.push(s++),a.push(s++),a.push(s++),a.push(s++);return{primitiveType:"lines",positions:i,indices:a}}function Tr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.xSize||1;t<0&&(console.error("negative xSize not allowed - will invert"),t*=-1);var r=e.zSize||1;r<0&&(console.error("negative zSize not allowed - will invert"),r*=-1);var n=e.xSegments||1;n<0&&(console.error("negative xSegments not allowed - will invert"),n*=-1),n<1&&(n=1);var o=e.xSegments||1;o<0&&(console.error("negative zSegments not allowed - will invert"),o*=-1),o<1&&(o=1);var i,a,s,u,c,l,h,f=e.center,d=f?f[0]:0,p=f?f[1]:0,v=f?f[2]:0,m=t/2,y=r/2,g=Math.floor(n)||1,x=Math.floor(o)||1,w=g+1,b=x+1,M=t/g,I=r/x,T=new Float32Array(w*b*3),A=new Float32Array(w*b*3),S=new Float32Array(w*b*2),O=0,L=0;for(i=0;i<b;i++){var P=i*I-y;for(a=0;a<w;a++)s=a*M-m,T[O]=s+d,T[O+1]=p,T[O+2]=-P+v,A[O+2]=-1,S[L]=a/g,S[L+1]=(x-i)/x,O+=3,L+=2}O=0;var E=new(T.length/3>65535?Uint32Array:Uint16Array)(g*x*6);for(i=0;i<x;i++)for(a=0;a<g;a++)u=a+w*i,c=a+w*(i+1),l=a+1+w*(i+1),h=a+1+w*i,E[O]=h,E[O+1]=c,E[O+2]=u,E[O+3]=h,E[O+4]=l,E[O+5]=c,O+=6;return{primitiveType:"triangles",positions:T,normals:A,uv:S,uvs:S,indices:E}}function Ar(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.lod||1,r=e.center?e.center[0]:0,n=e.center?e.center[1]:0,o=e.center?e.center[2]:0,i=e.radius||1;i<0&&(console.error("negative radius not allowed - will invert"),i*=-1);var a=e.heightSegments||18;a<0&&(console.error("negative heightSegments not allowed - will invert"),a*=-1),(a=Math.floor(t*a))<18&&(a=18);var s=e.widthSegments||18;s<0&&(console.error("negative widthSegments not allowed - will invert"),s*=-1),(s=Math.floor(t*s))<18&&(s=18);var u,c,l,h,f,d,p,v,m,y,g,x,w,b,M=[],I=[],T=[],A=[];for(u=0;u<=a;u++)for(l=u*Math.PI/a,h=Math.sin(l),f=Math.cos(l),c=0;c<=s;c++)d=2*c*Math.PI/s,p=Math.sin(d),v=Math.cos(d)*h,m=f,y=p*h,g=1-c/s,x=u/a,I.push(v),I.push(m),I.push(y),T.push(g),T.push(x),M.push(r+i*v),M.push(n+i*m),M.push(o+i*y);for(u=0;u<a;u++)for(c=0;c<s;c++)b=(w=u*(s+1)+c)+s+1,A.push(w+1),A.push(b+1),A.push(b),A.push(w+1),A.push(b),A.push(w);return{primitiveType:"triangles",positions:M,normals:I,uv:T,uvs:T,indices:A}}function Sr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.radius||1;t<0&&(console.error("negative radius not allowed - will invert"),t*=-1),t*=.5;var r=e.tube||.3;r<0&&(console.error("negative tube not allowed - will invert"),r*=-1);var n=e.radialSegments||32;n<0&&(console.error("negative radialSegments not allowed - will invert"),n*=-1),n<4&&(n=4);var o=e.tubeSegments||24;o<0&&(console.error("negative tubeSegments not allowed - will invert"),o*=-1),o<4&&(o=4);var i=e.arc||2*Math.PI;i<0&&(console.warn("negative arc not allowed - will invert"),i*=-1),i>360&&(i=360);var a,s,u,c,l,h,f,d,p,v,m,y,x=e.center,w=x?x[0]:0,b=x?x[1]:0,M=x?x[2]:0,I=[],T=[],A=[],S=[];for(d=0;d<=o;d++)for(f=0;f<=n;f++)a=f/n*i,s=.785398+d/o*Math.PI*2,w=t*Math.cos(a),b=t*Math.sin(a),u=(t+r*Math.cos(s))*Math.cos(a),c=(t+r*Math.cos(s))*Math.sin(a),l=r*Math.sin(s),I.push(u+w),I.push(c+b),I.push(l+M),A.push(1-f/n),A.push(d/o),h=g.normalizeVec3(g.subVec3([u,c,l],[w,b,M],[]),[]),T.push(h[0]),T.push(h[1]),T.push(h[2]);for(d=1;d<=o;d++)for(f=1;f<=n;f++)p=(n+1)*d+f-1,v=(n+1)*(d-1)+f-1,m=(n+1)*(d-1)+f,y=(n+1)*d+f,S.push(p),S.push(v),S.push(m),S.push(m),S.push(y),S.push(p);return{primitiveType:"triangles",positions:I,normals:T,uv:A,uvs:A,indices:S}}var Or={" ":{width:16,points:[]},"!":{width:10,points:[[5,21],[5,7],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},'"':{width:16,points:[[4,21],[4,14],[-1,-1],[12,21],[12,14]]},"#":{width:21,points:[[11,25],[4,-7],[-1,-1],[17,25],[10,-7],[-1,-1],[4,12],[18,12],[-1,-1],[3,6],[17,6]]},$:{width:20,points:[[8,25],[8,-4],[-1,-1],[12,25],[12,-4],[-1,-1],[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},"%":{width:24,points:[[21,21],[3,0],[-1,-1],[8,21],[10,19],[10,17],[9,15],[7,14],[5,14],[3,16],[3,18],[4,20],[6,21],[8,21],[10,20],[13,19],[16,19],[19,20],[21,21],[-1,-1],[17,7],[15,6],[14,4],[14,2],[16,0],[18,0],[20,1],[21,3],[21,5],[19,7],[17,7]]},"&":{width:26,points:[[23,12],[23,13],[22,14],[21,14],[20,13],[19,11],[17,6],[15,3],[13,1],[11,0],[7,0],[5,1],[4,2],[3,4],[3,6],[4,8],[5,9],[12,13],[13,14],[14,16],[14,18],[13,20],[11,21],[9,20],[8,18],[8,16],[9,13],[11,10],[16,3],[18,1],[20,0],[22,0],[23,1],[23,2]]},"'":{width:10,points:[[5,19],[4,20],[5,21],[6,20],[6,18],[5,16],[4,15]]},"(":{width:14,points:[[11,25],[9,23],[7,20],[5,16],[4,11],[4,7],[5,2],[7,-2],[9,-5],[11,-7]]},")":{width:14,points:[[3,25],[5,23],[7,20],[9,16],[10,11],[10,7],[9,2],[7,-2],[5,-5],[3,-7]]},"*":{width:16,points:[[8,21],[8,9],[-1,-1],[3,18],[13,12],[-1,-1],[13,18],[3,12]]},"+":{width:26,points:[[13,18],[13,0],[-1,-1],[4,9],[22,9]]},",":{width:10,points:[[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"-":{width:26,points:[[4,9],[22,9]]},".":{width:10,points:[[5,2],[4,1],[5,0],[6,1],[5,2]]},"/":{width:22,points:[[20,25],[2,-7]]},0:{width:20,points:[[9,21],[6,20],[4,17],[3,12],[3,9],[4,4],[6,1],[9,0],[11,0],[14,1],[16,4],[17,9],[17,12],[16,17],[14,20],[11,21],[9,21]]},1:{width:20,points:[[6,17],[8,18],[11,21],[11,0]]},2:{width:20,points:[[4,16],[4,17],[5,19],[6,20],[8,21],[12,21],[14,20],[15,19],[16,17],[16,15],[15,13],[13,10],[3,0],[17,0]]},3:{width:20,points:[[5,21],[16,21],[10,13],[13,13],[15,12],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},4:{width:20,points:[[13,21],[3,7],[18,7],[-1,-1],[13,21],[13,0]]},5:{width:20,points:[[15,21],[5,21],[4,12],[5,13],[8,14],[11,14],[14,13],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},6:{width:20,points:[[16,18],[15,20],[12,21],[10,21],[7,20],[5,17],[4,12],[4,7],[5,3],[7,1],[10,0],[11,0],[14,1],[16,3],[17,6],[17,7],[16,10],[14,12],[11,13],[10,13],[7,12],[5,10],[4,7]]},7:{width:20,points:[[17,21],[7,0],[-1,-1],[3,21],[17,21]]},8:{width:20,points:[[8,21],[5,20],[4,18],[4,16],[5,14],[7,13],[11,12],[14,11],[16,9],[17,7],[17,4],[16,2],[15,1],[12,0],[8,0],[5,1],[4,2],[3,4],[3,7],[4,9],[6,11],[9,12],[13,13],[15,14],[16,16],[16,18],[15,20],[12,21],[8,21]]},9:{width:20,points:[[16,14],[15,11],[13,9],[10,8],[9,8],[6,9],[4,11],[3,14],[3,15],[4,18],[6,20],[9,21],[10,21],[13,20],[15,18],[16,14],[16,9],[15,4],[13,1],[10,0],[8,0],[5,1],[4,3]]},":":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},";":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"<":{width:24,points:[[20,18],[4,9],[20,0]]},"=":{width:26,points:[[4,12],[22,12],[-1,-1],[4,6],[22,6]]},">":{width:24,points:[[4,18],[20,9],[4,0]]},"?":{width:18,points:[[3,16],[3,17],[4,19],[5,20],[7,21],[11,21],[13,20],[14,19],[15,17],[15,15],[14,13],[13,12],[9,10],[9,7],[-1,-1],[9,2],[8,1],[9,0],[10,1],[9,2]]},"@":{width:27,points:[[18,13],[17,15],[15,16],[12,16],[10,15],[9,14],[8,11],[8,8],[9,6],[11,5],[14,5],[16,6],[17,8],[-1,-1],[12,16],[10,14],[9,11],[9,8],[10,6],[11,5],[-1,-1],[18,16],[17,8],[17,6],[19,5],[21,5],[23,7],[24,10],[24,12],[23,15],[22,17],[20,19],[18,20],[15,21],[12,21],[9,20],[7,19],[5,17],[4,15],[3,12],[3,9],[4,6],[5,4],[7,2],[9,1],[12,0],[15,0],[18,1],[20,2],[21,3],[-1,-1],[19,16],[18,8],[18,6],[19,5]]},A:{width:18,points:[[9,21],[1,0],[-1,-1],[9,21],[17,0],[-1,-1],[4,7],[14,7]]},B:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[-1,-1],[4,11],[13,11],[16,10],[17,9],[18,7],[18,4],[17,2],[16,1],[13,0],[4,0]]},C:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5]]},D:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[11,21],[14,20],[16,18],[17,16],[18,13],[18,8],[17,5],[16,3],[14,1],[11,0],[4,0]]},E:{width:19,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11],[-1,-1],[4,0],[17,0]]},F:{width:18,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11]]},G:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[18,8],[-1,-1],[13,8],[18,8]]},H:{width:22,points:[[4,21],[4,0],[-1,-1],[18,21],[18,0],[-1,-1],[4,11],[18,11]]},I:{width:8,points:[[4,21],[4,0]]},J:{width:16,points:[[12,21],[12,5],[11,2],[10,1],[8,0],[6,0],[4,1],[3,2],[2,5],[2,7]]},K:{width:21,points:[[4,21],[4,0],[-1,-1],[18,21],[4,7],[-1,-1],[9,12],[18,0]]},L:{width:17,points:[[4,21],[4,0],[-1,-1],[4,0],[16,0]]},M:{width:24,points:[[4,21],[4,0],[-1,-1],[4,21],[12,0],[-1,-1],[20,21],[12,0],[-1,-1],[20,21],[20,0]]},N:{width:22,points:[[4,21],[4,0],[-1,-1],[4,21],[18,0],[-1,-1],[18,21],[18,0]]},O:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21]]},P:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,14],[17,12],[16,11],[13,10],[4,10]]},Q:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21],[-1,-1],[12,4],[18,-2]]},R:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[4,11],[-1,-1],[11,11],[18,0]]},S:{width:20,points:[[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},T:{width:16,points:[[8,21],[8,0],[-1,-1],[1,21],[15,21]]},U:{width:22,points:[[4,21],[4,6],[5,3],[7,1],[10,0],[12,0],[15,1],[17,3],[18,6],[18,21]]},V:{width:18,points:[[1,21],[9,0],[-1,-1],[17,21],[9,0]]},W:{width:24,points:[[2,21],[7,0],[-1,-1],[12,21],[7,0],[-1,-1],[12,21],[17,0],[-1,-1],[22,21],[17,0]]},X:{width:20,points:[[3,21],[17,0],[-1,-1],[17,21],[3,0]]},Y:{width:18,points:[[1,21],[9,11],[9,0],[-1,-1],[17,21],[9,11]]},Z:{width:20,points:[[17,21],[3,0],[-1,-1],[3,21],[17,21],[-1,-1],[3,0],[17,0]]},"[":{width:14,points:[[4,25],[4,-7],[-1,-1],[5,25],[5,-7],[-1,-1],[4,25],[11,25],[-1,-1],[4,-7],[11,-7]]},"\\":{width:14,points:[[0,21],[14,-3]]},"]":{width:14,points:[[9,25],[9,-7],[-1,-1],[10,25],[10,-7],[-1,-1],[3,25],[10,25],[-1,-1],[3,-7],[10,-7]]},"^":{width:16,points:[[6,15],[8,18],[10,15],[-1,-1],[3,12],[8,17],[13,12],[-1,-1],[8,17],[8,0]]},_:{width:16,points:[[0,-2],[16,-2]]},"`":{width:10,points:[[6,21],[5,20],[4,18],[4,16],[5,15],[6,16],[5,17]]},a:{width:19,points:[[15,14],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},b:{width:19,points:[[4,21],[4,0],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},c:{width:18,points:[[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},d:{width:19,points:[[15,21],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},e:{width:18,points:[[3,8],[15,8],[15,10],[14,12],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},f:{width:12,points:[[10,21],[8,21],[6,20],[5,17],[5,0],[-1,-1],[2,14],[9,14]]},g:{width:19,points:[[15,14],[15,-2],[14,-5],[13,-6],[11,-7],[8,-7],[6,-6],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},h:{width:19,points:[[4,21],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},i:{width:8,points:[[3,21],[4,20],[5,21],[4,22],[3,21],[-1,-1],[4,14],[4,0]]},j:{width:10,points:[[5,21],[6,20],[7,21],[6,22],[5,21],[-1,-1],[6,14],[6,-3],[5,-6],[3,-7],[1,-7]]},k:{width:17,points:[[4,21],[4,0],[-1,-1],[14,14],[4,4],[-1,-1],[8,8],[15,0]]},l:{width:8,points:[[4,21],[4,0]]},m:{width:30,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0],[-1,-1],[15,10],[18,13],[20,14],[23,14],[25,13],[26,10],[26,0]]},n:{width:19,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},o:{width:19,points:[[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3],[16,6],[16,8],[15,11],[13,13],[11,14],[8,14]]},p:{width:19,points:[[4,14],[4,-7],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},q:{width:19,points:[[15,14],[15,-7],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},r:{width:13,points:[[4,14],[4,0],[-1,-1],[4,8],[5,11],[7,13],[9,14],[12,14]]},s:{width:17,points:[[14,11],[13,13],[10,14],[7,14],[4,13],[3,11],[4,9],[6,8],[11,7],[13,6],[14,4],[14,3],[13,1],[10,0],[7,0],[4,1],[3,3]]},t:{width:12,points:[[5,21],[5,4],[6,1],[8,0],[10,0],[-1,-1],[2,14],[9,14]]},u:{width:19,points:[[4,14],[4,4],[5,1],[7,0],[10,0],[12,1],[15,4],[-1,-1],[15,14],[15,0]]},v:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0]]},w:{width:22,points:[[3,14],[7,0],[-1,-1],[11,14],[7,0],[-1,-1],[11,14],[15,0],[-1,-1],[19,14],[15,0]]},x:{width:17,points:[[3,14],[14,0],[-1,-1],[14,14],[3,0]]},y:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0],[6,-4],[4,-6],[2,-7],[1,-7]]},z:{width:17,points:[[14,14],[3,0],[-1,-1],[3,14],[14,14],[-1,-1],[3,0],[14,0]]},"{":{width:14,points:[[9,25],[7,24],[6,23],[5,21],[5,19],[6,17],[7,16],[8,14],[8,12],[6,10],[-1,-1],[7,24],[6,22],[6,20],[7,18],[8,17],[9,15],[9,13],[8,11],[4,9],[8,7],[9,5],[9,3],[8,1],[7,0],[6,-2],[6,-4],[7,-6],[-1,-1],[6,8],[8,6],[8,4],[7,2],[6,1],[5,-1],[5,-3],[6,-5],[7,-6],[9,-7]]},"|":{width:8,points:[[4,25],[4,-7]]},"}":{width:14,points:[[5,25],[7,24],[8,23],[9,21],[9,19],[8,17],[7,16],[6,14],[6,12],[8,10],[-1,-1],[7,24],[8,22],[8,20],[7,18],[6,17],[5,15],[5,13],[6,11],[10,9],[6,7],[5,5],[5,3],[6,1],[7,0],[8,-2],[8,-4],[7,-6],[-1,-1],[8,8],[6,6],[6,4],[7,2],[8,1],[9,-1],[9,-3],[8,-5],[7,-6],[5,-7]]},"~":{width:24,points:[[3,6],[3,8],[4,11],[6,12],[8,12],[10,11],[14,8],[16,7],[18,7],[20,8],[21,10],[-1,-1],[3,8],[4,10],[6,11],[8,11],[10,10],[14,7],[16,6],[18,6],[20,7],[21,10],[21,12]]}};function Lr(){for(var e,t,r,n,o,i,a,s,u,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=c.origin||[0,0,0],h=l[0],f=l[1],d=l[2],p=c.size||1,v=[],m=[],y=(""+c.text).trim(),g=(y||"").split("\n"),x=0,w=0,b=.04,M=0;M<g.length;M++){e=0,r=(t=g[M]).length;for(var I=0;I<r;I++)if(n=Or[t.charAt(I)]){o=1,i=-1,a=-1,s=n.points.length;for(var T=0;T<s;T++)-1!==(u=n.points[T])[0]||-1!==u[1]?(v.push(e+u[0]*p*b+h),v.push(w+u[1]*p*b+f),v.push(0+d),-1===i?i=x:(-1===a||(i=a),a=x),x++,o?o=!1:(m.push(i),m.push(a))):o=1;e+=n.width*b*p}w-=35*b*p}return{primitiveType:"lines",positions:v,indices:m}}function Pr(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;++n)r[n]=e[n];return t}function Er(e){return Er="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Er(e)}function jr(){jr=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var o=t&&t.prototype instanceof h?t:h,i=Object.create(o.prototype),a=new I(n||[]);return i._invoke=function(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=c(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(e,r,a),i}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var l={};function h(){}function f(){}function d(){}var p={};s(p,o,(function(){return this}));var v=Object.getPrototypeOf,m=v&&v(v(T([])));m&&m!==t&&r.call(m,o)&&(p=m);var y=d.prototype=h.prototype=Object.create(p);function g(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(o,i,a,s){var u=c(e[o],e,i);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==Er(h)&&r.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(h).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,s)}))}s(u.arg)}var o;this._invoke=function(e,r){function i(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(i,i):i()}}function w(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function T(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:A}}function A(){return{value:void 0,done:!0}}return f.prototype=d,s(y,"constructor",d),s(d,"constructor",f),f.displayName=s(d,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,s(e,a,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},g(x.prototype),s(x.prototype,i,(function(){return this})),e.AsyncIterator=x,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new x(u(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},g(y),s(y,a,"Generator"),s(y,o,(function(){return this})),s(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=T,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(M),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),M(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;M(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:T(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}function Gr(e,t,r,n,o,i,a){try{var s=e[i](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}var _r=r(231);function Dr(e){var t=e.WebIFC,r=e.source,n=e.sourceData,o=e.sourceFormat,i=e.metaModelSource,a=e.metaModelData,s=e.output,u=e.outputXKTModel,c=e.outputXKT,l=e.includeTypes,h=e.excludeTypes,d=e.reuseGeometries,p=e.stats,v=void 0===p?{}:p,m=e.outputStats,y=e.rotateX,g=e.includeTextures,x=e.includeNormals,w=e.log,b=void 0===w?function(e){}:w;return v.sourceFormat="",v.schemaVersion="",v.title="",v.author="",v.created="",v.numMetaObjects=0,v.numPropertySets=0,v.numTriangles=0,v.numVertices=0,v.numNormals=0,v.numUVs=0,v.numTextures=0,v.numTextureSets=0,v.numObjects=0,v.numGeometries=0,v.sourceSize=0,v.xktSize=0,v.texturesSize=0,v.xktVersion="",v.compressionRatio=0,v.conversionTime=0,v.aabb=null,new Promise((function(e,p){var w=b;if(b=function(e){w("[convert2xkt] ".concat(e))},r||n)if(o||!n)if(s||u||c){r&&b("Reading input file: "+r);var M=new Date,I=o||r.split(".").pop();if(!n)try{n=_r.readFileSync(r)}catch(e){return void p(e)}var T=n.byteLength;if(b("Input file size: "+(T/1e3).toFixed(2)+" kB"),!a&&i){b("Reading input metadata file: "+i);try{var A=_r.readFileSync(i);a=JSON.parse(A)}catch(e){return void p(e)}}!1===d&&b("Geometry reuse is disabled");var S=new Le;a?Ht({metaModelData:a,xktModel:S}).then((function(){O()}),(function(e){p(e)})):O()}else p("Argument expected: output, outputXKTModel or outputXKT");else p("Argument expected: sourceFormat is required with sourceData");else p("Argument expected: source or sourceData");function O(){switch(I){case"json":L(dt,{data:JSON.parse(n),xktModel:S,stats:v,rotateX:y,log:b});break;case"glb":case"gltf":var e=r?kr(r):"",o="glb"!==I&&!g;L(o?kt:Tt,{data:o?JSON.parse(n):n,reuseGeometries:d,includeTextures:g,includeNormals:x,metaModelData:a,xktModel:S,getAttachment:(i=jr().mark((function t(r){var n;return jr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return b("Reading attachment file: ".concat(n=e+r)),t.abrupt("return",Pr(_r.readFileSync(n)));case 3:case"end":return t.stop()}}),t)})),s=function(){var e=this,t=arguments;return new Promise((function(r,n){var o=i.apply(e,t);function a(e){Gr(o,r,n,a,s,"next",e)}function s(e){Gr(o,r,n,a,s,"throw",e)}a(void 0)}))},function(e){return s.apply(this,arguments)}),stats:v,log:b});break;case"ifc":L(Rt,{WebIFC:t,data:n,xktModel:S,wasmPath:"./",includeTypes:l,excludeTypes:h,stats:v,log:b});break;case"laz":L(Yt,{data:n,xktModel:S,stats:v,rotateX:y,log:b});break;case"las":L(Yt,{data:n,xktModel:S,stats:v,log:b});break;case"pcd":L($t,{data:n,xktModel:S,stats:v,log:b});break;case"ply":L(ir,{data:n,xktModel:S,stats:v,log:b});break;case"stl":L(hr,{data:n,xktModel:S,stats:v,log:b});break;default:return void p('Error: unsupported source format: "'.concat(I,'".'))}var i,s}function L(t,r){t(r).then((function(){S.createDefaultMetaObjects(),b("Input file parsed OK. Building XKT document..."),S.finalize().then((function(){b("XKT document built OK. Writing to XKT file...");var t=je(S,v),r=Buffer.from(t),n=t.byteLength;if(v.sourceSize=(T/1e3).toFixed(2),v.xktSize=(n/1e3).toFixed(2),v.xktVersion=f.xktVersion,v.compressionRatio=(T/n).toFixed(2),v.conversionTime=((new Date-M)/1e3).toFixed(2),v.aabb=S.aabb,b("Converted to: XKT v".concat(v.xktVersion)),l&&b("Include types: "+(l||"(include all)")),h&&b("Exclude types: "+(h||"(exclude none)")),b("XKT size: "+v.xktSize+" kB"),b("XKT textures size: "+(v.texturesSize/1e3).toFixed(2)+"kB"),b("Compression ratio: "+v.compressionRatio),b("Conversion time: "+v.conversionTime+" s"),b("Converted metaobjects: "+v.numMetaObjects),b("Converted property sets: "+v.numPropertySets),b("Converted drawable objects: "+v.numObjects),b("Converted geometries: "+v.numGeometries),b("Converted textures: "+v.numTextures),b("Converted textureSets: "+v.numTextureSets),b("Converted triangles: "+v.numTriangles),b("Converted vertices: "+v.numVertices),b("Converted UVs: "+v.numUVs),b("Converted normals: "+v.numNormals),s){var o=kr(s).trim();""===o||_r.existsSync(o)||_r.mkdirSync(o,{recursive:!0}),b("Writing XKT file: "+s),_r.writeFileSync(s,r)}u&&u(S),c&&c(r),m&&m(v),e()}))}),(function(e){p(e)}))}}))}function kr(e){var t=e.lastIndexOf("/");return 0!==t?e.substring(0,t+1):""}(0,e.installFilePolyfills)()})(),n})()));
//# sourceMappingURL=xeokit-convert.cjs.js.map